(function(){
'use strict';var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},e="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;
function ba(a,b){if(b){var c=e;a=a.split(".");for(var d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ba("String.prototype.repeat",function(a){return a?a:function(a){var c;if(null==this)throw new TypeError("The 'this' value for String.prototype.repeat must not be null or undefined");c=this+"";if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=c),a>>>=1)c+=c;return d}});function ca(){ca=function(){};e.Symbol||(e.Symbol=da)}var ea=0;function da(a){return"jscomp_symbol_"+(a||"")+ea++}
function fa(){ca();var a=e.Symbol.iterator;a||(a=e.Symbol.iterator=e.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return ga(this)}});fa=function(){}}function ga(a){var b=0;return ha(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function ha(a){fa();a={next:a};a[e.Symbol.iterator]=function(){return this};return a}
ba("Array.from",function(a){return a?a:function(a,c,d){fa();c=c?c:function(a){return a};var f=[],g=a[Symbol.iterator];if("function"==typeof g)for(a=g.call(a);!(g=a.next()).done;)f.push(c.call(d,g.value));else for(var g=a.length,k=0;k<g;k++)f.push(c.call(d,a[k]));return f}});
function ia(a,b){fa();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}ba("Array.prototype.keys",function(a){return a?a:function(){return ia(this,function(a){return a})}});
ba("Array.prototype.fill",function(a){return a?a:function(a,c,d){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==d||d>f)d=f;d=Number(d);0>d&&(d=Math.max(0,f+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}});
var ja={addc:"vec2 addc(vec2 a,vec2 b){\nreturn a+b;\n}\n",arccosc:"vec2 arccosc(vec2 a){\nvec2 t2=multc(a,negc(a));\nvec2 tmp=sqrtc(addc(vec2(1.0,0.0),t2));\nvec2 tmp1=addc(multc(a,vec2(0.0,1.0)),tmp);\nvec2 erg=addc(multc(logc(tmp1),vec2(0.0,1.0)),vec2(pi*0.5,0.0));\nreturn erg;\n}\n",arccosf:"vec2 arccosf(float z){\nif(abs(z)<=1.)return vec2(acos(z),0.);\nelse if(z>1.)return vec2(0,log(z+sqrt(z*z-1.)));\nelse return vec2(pi, -log(-z+sqrt(z*z-1.)));\n}\n",arcsinc:"vec2 arcsinc(vec2 a){\nvec2 t2=multc(a,negc(a));\nvec2 tmp=sqrtc(addc(vec2(1.0,0.0),t2));\nvec2 tmp1=addc(multc(a,vec2(0.0,1.0)),tmp);\nvec2 erg=multc(logc(tmp1),vec2(0.0,-1.0));\nreturn erg;\n}\n",
arcsinf:"vec2 arcsinf(float z){\nif(abs(z)<=1.)return vec2(asin(z),0.);\nelse if(z>1.)return vec2(pi*.5, -log(z+sqrt(z*z-1.)));\nelse return vec2(-pi*.5,log(-z+sqrt(z*z-1.)));\n}\n",arctan2c:"\n\n\n\nvec2 arctan2c(vec2 x,vec2 y){\nvec2 r=logc(divc(x+vec2(-y.y,y.x),sqrtc(multc(x,x)+multc(y,y))));\nreturn vec2(r.y, -r.x);\n}\n",arctan2cvec2:"vec2 arctan2cvec2(cvec2 v){\nreturn arctan2c(v.real,v.imag);\n}\n",arctan2vec2:"float arctan2vec2(vec2 v){\nreturn atan(v.y,v.x);\n}\n",arctanc:"vec2 arctanc(vec2 a){\nvec2 t1=logc(addc(multc(a,vec2(0.0,-1.0)),vec2(1.0,0.0)));\nvec2 t2=logc(addc(multc(a,vec2(0.0,1.0)),vec2(1.0,0.0)));\nvec2 erg=multc(subc(t1,t2),vec2(0.0,0.5));\nreturn erg;\n}\n",
blue:"vec3 blue(float f)\n{\nreturn vec3(0.,0.,clamp(f,0.,1.));\n}\n",cimag:"float imagc(vec2 a){\nreturn a.y;\n}\n",conjugate:"vec2 conjugate(vec2 a){\nreturn vec2(a.x, -a.y);\n}\n",copytexture_f:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D sampler;\nvarying vec2 cgl_pixel;\n\nvoid main(void){\ngl_FragColor=texture2D(sampler,cgl_pixel);\n}\n",copytexture_v:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying vec2 cgl_pixel;\n\nvoid main(void){\ngl_Position=vec4(aPos,1.);\ncgl_pixel=aTexCoord;\n}\n",
cosc:"vec2 cosc(vec2 a){\n\nfloat n=exp(a.y);\nfloat imag1=n*sin(-a.x);\nfloat real1=n*cos(-a.x);\nn=exp(-a.y);\nfloat imag2=n*sin(a.x);\nfloat real2=n*cos(a.x);\nfloat i= (imag1+imag2) /2.0;\nfloat r= (real1+real2) /2.0;\n\nreturn vec2(r,i);\n}\n",creal:"float realc(vec2 a){\nreturn a.x;\n}\n",dehomogenize:"vec2 dehomogenize(vec3 z){\nreturn vec2(z.x,z.y)/z.z;\n}\n",divc:"vec2 divc(vec2 a,vec2 b){\nreturn vec2(dot(a,b),dot(a,vec2(-b.y,b.x)))/dot(b,b);\n}\n",divfc:"vec2 divfc(float a,vec2 b){\nreturn a*vec2(b.x,-b.y)/dot(b,b);\n}\n",
expc:"vec2 expc(vec2 a){\nfloat n=exp(a.x);\nfloat r=n*cos(a.y);\nfloat i=n*sin(a.y);\nreturn vec2(r,i);\n}\n",float2color:"vec4 float2color(float f)\n{\nreturn vec4(f,f,f,1.);\n}\n",gray:"vec3 gray(float f)\n{\nf=clamp(f,0.,1.);\nreturn vec3(f,f,f);\n}\n",green:"vec3 green(float f)\n{\nreturn vec3(0.,clamp(f,0.,1.),0.);\n}\n",hsv2rgb:"vec3 hsv2rgb(vec3 c)\n{\nvec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);\nvec3 p=abs(fract(c.xxx+K.xyz) *6.0-K.www);\nreturn c.z*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),c.y);\n}\n",
hue:"vec3 hue(float a){\nreturn hsv2rgb(vec3(a,1.,1.));\n}\n",imagc:"float imagc(vec2 a){\nreturn a.y;\n}\n",invc:"vec2 invc(vec2 a){\nfloat n=a.x*a.x+a.y*a.y;\nreturn vec2(a.x/n,-a.y/n);\n}\n",logc:"vec2 logc(vec2 a){\nfloat re=a.x;\nfloat im=a.y;\nfloat s=sqrt(re*re+im*im);\nfloat i=im;\nfloat imag=atan(im,re);\nif(i<0.0){\nimag+= (2.0*pi);\n}\nif(i==0.0&&re<0.0){\nimag=pi;\n}\nif(imag>pi){\nimag-= (2.0*pi);\n};\nfloat real=log(s);\n\nreturn vec2(real,imag);\n}\n",logr:"vec2 logr(float a){\nif(a>=0.)return vec2(log(a),0);\nelse return vec2(log(-a),pi);\n}\n",
mat2complex:"mat4 mat2complex(mat2 a)\n{\nreturn mat4(\nvec4(a[0][0],0,a[0][1],0),\nvec4(0,a[0][0],0,a[0][1]),\nvec4(a[1][0],0,a[1][1],0),\nvec4(0,a[1][0],0,a[1][1])\n);\n}\n",multc:"vec2 multc(vec2 a,vec2 b){\nreturn vec2(dot(a,vec2(b.x,-b.y)),dot(a,b.yx));\n}\n",negc:"vec2 negc(vec2 a){\nreturn vec2(-a.x,-a.y);\n}\n",powc:"vec2 powc(vec2 a,vec2 b){\nreturn(b.x==0. &&b.y==0.) ?vec2(1.,0.) : ((a.x==0. &&a.y==0.) ?vec2(0.) :expc(multc(logc(a),b)));\n}\n",powi:"float powi(float a,int b){\nif(mod(float(b),2.) < .5)\nreturn pow(abs(a),float(b));\nelse\nreturn sign(a)*pow(abs(a),float(b));\n}\n",
random:"uniform float rnd_;\n\nfloat last_rnd= .1231;\nfloat random(){\nfloat a=fract(132422.21*sin(dot(plain_pixel,343433.671228*vec2(.176574+last_rnd, .1131+rnd_))));\nfloat b=fract(last_rnd*2321.2312*sin(dot(plain_pixel+vec2(rnd_,last_rnd),plain_pixel) *43758.5453));\nlast_rnd=fract(rnd_ +last_rnd+a+b);\nreturn last_rnd;\n}\n",randomnormal:"float randomnormal(){\nreturn sqrt(-2. *log(random())) *cos(6.283185307179586*random());\n}\n",realc:"float realc(vec2 a){\nreturn a.x;\n}\n",red:"vec3 red(float f)\n{\nreturn vec3(clamp(f,0.,1.),0.,0.);\n}\n",
rgb2hsv:"vec3 rgb2hsv(vec3 c)\n{\nvec4 K=vec4(0.0, -1.0/3.0,2.0/3.0, -1.0);\nvec4 p=mix(vec4(c.bg,K.wz),vec4(c.gb,K.xy),step(c.b,c.g));\nvec4 q=mix(vec4(p.xyw,c.r),vec4(c.r,p.yzx),step(p.x,c.r));\n\nfloat d=q.x-min(q.w,q.y);\nfloat e=1.0e-10;\nreturn vec3(abs(q.z+ (q.w-q.y) / (6.0*d+e)),d/ (q.x+e),q.x);\n}\n",sinc:"\n\nvec2 sinc(vec2 a){\n\nfloat n=exp(a.y);\nfloat imag1=n*sin(-a.x);\nfloat real1=n*cos(-a.x);\nn=exp(-a.y);\nfloat imag2=n*sin(a.x);\nfloat real2=n*cos(a.x);\nfloat r= -(imag1-imag2) /2.0;\nfloat i= (real1-real2) /2.0;\n\nreturn vec2(r,i);\n}\n",
sqrtc:"vec2 sqrtc(vec2 a){\nreturn expc(multc(logc(a),vec2(0.5,0.0)));\n}\n",sqrtf:"vec2 sqrtf(float a){\nif(a>=0.)return vec2(sqrt(a),0.);\nelse return vec2(0.,sqrt(-a));\n}\n",standardFragmentHeader:"#ifdef GL_ES\nprecision highp float;\nprecision highp int;\n#endif\n\n#define pi 3.141592653589793\n\nvarying vec2 cgl_pixel;\nvarying vec2 plain_pixel;\n",subc:"vec2 subc(vec2 a,vec2 b){\nreturn a-b;\n}\n",tanc:"vec2 tanc(vec2 a){\nvec2 s=sinc(a);\nvec2 c=cosc(a);\nreturn divc(s,c);\n}\n",vec2complex:"vec4 vec2complex(vec2 a)\n{\nreturn vec4(a.x,0.,a.y,0);\n}\n",
vshader:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying vec2 cgl_pixel;\nvarying vec2 plain_pixel;\nuniform mat3 transformMatrix;\nvoid main(void){\ngl_Position=vec4(aPos,1.);\nplain_pixel=aTexCoord;\nvec3 r=transformMatrix*vec3(plain_pixel,1);\ncgl_pixel=r.xy/r.z;\n}\n"};var ma=!1,h,m,n,r,v=!1,na,w=!1,oa=!1,pa=1;
function qa(){function a(c){h.removeEventListener("webglcontextcreationerror",a,!1);c.statusMessage&&(b=c.statusMessage)}if(!ma){h=document.createElement("canvas");h.id="glcanvas";h.style.display="none";h.width=h.height=0;document.body.appendChild(h);m=document.createElement("canvas");m.id="tmpcanvas";m.style.display="none";m.width=m.height=0;document.body.appendChild(m);var b="Unknown";h.addEventListener("webglcontextcreationerror",a,!1);(n=h.getContext("webgl"))||(n=h.getContext("experimental-webgl"));
if(!n)throw new ra("Could not obtain a WebGL context.\nReason: "+b);h.removeEventListener("webglcontextcreationerror",a,!1);oa||(w=n.getExtension("OES_texture_float")&&n.getExtension("OES_texture_float_linear"),w||(console.error("Your browser does not suppert OES_texture_float, trying OES_texture_half_float..."),(v=(na=n.getExtension("OES_texture_half_float"))&&n.getExtension("OES_texture_half_float_linear"))||console.error("Your browser does not suppert OES_texture_half_float, will use 8-bit textures.")),
navigator.userAgent.match(/(iPad|iPhone)/i)&&(console.log("You are  using an iPhone/iPad."),w=v=!1,n.getExtension("OES_texture_half_float")&&n.getExtension("OES_texture_half_float_linear")&&n.getExtension("EXT_color_buffer_half_float")?v=!0:console.error("Your browser does not suppert writing to half_float textures, we will use 8-bit textures.")));ma=!0}};function sa(a){var b;if(null==a||"object"!=typeof a)return a;if(a instanceof Array){b=[];for(var c=0,d=a.length;c<d;c++)b[c]=sa(a[c]);return b}if(a instanceof Object){b={};for(c in a)a.hasOwnProperty(c)&&(0<="oper impl args ctype stack name arglist value real imag key obj body".split(" ").indexOf(c)&&(b[c]=sa(a[c])),a.modifs&&(b.modifs=a.modifs));return b}}
function ta(a,b){if(null==a||"object"!=typeof a)return a===b;if(a instanceof Array&&b instanceof Array){if(a.length!=b.length)return!1;for(var c=0,d=a.length;c<d;c++)if(!ta(a[c],b[c]))return!1;return!0}if(a instanceof Object&&b instanceof Object){c="oper impl args ctype stack name modifs arglist value real imag key obj body".split(" ");for(d=0;d<c.length;d++){var f=c[d];if(!ta(a[f],b[f]))return!1}return!0}return!1}function y(a){return-1===a.indexOf("$")?a:a.substr(0,a.indexOf("$"))}
function z(a){if("boolean"===a.ctype)return A.B;if("number"===a.ctype)return a=a.value,1E-5>Math.abs(a.imag)?(a.real|0)===a.real?A.v:A.f:A.h;if("list"===a.ctype){var b=a.value;if(0<b.length){for(var c=z(b[0]),d=1;d<b.length;d++)c=B(c,z(b[d]));if(c)return{type:"list",length:b.length,i:c}}}else if("string"===a.ctype||"image"===a.ctype)return A.image;console.error("Cannot guess type of the following type:");console.log(a);return!1}var ua=0;function C(){ua++;return"_h"+ua}
function va(a,b){if(a>h.width||b>h.height)h.width=Math.ceil(a),h.height=Math.ceil(b)}function wa(a,b,c){a=a.getInitialMatrix();b-=a.tx;c+=a.ty;return{x:(b*a.d-c*a.b)/a.det,y:-(-b*a.c+c*a.a)/a.det}}function xa(a){return wa(a,0,a.instance.canvas.clientHeight)}function ya(a){return wa(a,a.instance.canvas.clientWidth,a.instance.canvas.clientHeight)}var za=new Float32Array(1),Aa=new Int32Array(za.buffer);
function Ba(a){za[0]=a;a=Aa[0];var b=a>>16&32768,c=(a&2147483647)+4096;if(1199570944<=c)return 1199570944<=(a&2147483647)?2139095040>c?b|31744:b|31744|(a&8388607)>>13:b|31743;if(947912704<=c)return b|c-939524096>>13;if(855638016>c)return b;c=(a&2147483647)>>23;return b|(a&8388607|8388608)+(8388608>>>c-102)>>126-c}
function Ca(a){if(w)return new Float32Array(a);if(v){for(var b=new Uint16Array(a.length),c=0;c<a.length;c++)b[c]=Ba(a[c]);return b}b=new Uint8Array(a.length);for(c=0;c<a.length;c++)b[c]=255*a[c];return b}function Da(a){return w?new Float32Array(a):v?new Uint16Array(a):new Uint8Array(a)}function Ea(){return w?n.FLOAT:v?na.HALF_FLOAT_OES:n.UNSIGNED_BYTE}
function Fa(a){for(var b=[],c=0;c<a.length;c++)if(w)b.push(a[c]);else if(v){var d=a[c],f=(d&31744)>>10,g=d&1023;b.push((d>>15?-1:1)*(f?31===f?g?NaN:Infinity:Math.pow(2,f-15)*(1+g/1024):g/1024*6.103515625E-5))}else b.push(a[c]/255);return b}function Ga(a){for(var b=1;b<a;)b<<=1;return b};function Ha(a,b){a.canvaswrapper?b&&Ia(a.canvaswrapper,b):(a.canvaswrapper=new Ja(a,b||{S:!0,K:!1,repeat:!1}),a.ready||(console.error("Image not ready. Creating onload event."),a.whenReady(function(){a.generation=Math.max(a.generation,a.canvaswrapper.generation+1)})));return a.canvaswrapper}
function Ja(a,b){this.canvas=a;this.j=b;this.J=a.width;this.F=a.height;Ka(this);this.R=0;this.m=[];this.ba=[];this.generation=-1;this.bindTexture();a.drawTo=this.drawTo.bind(this);a.readPixels=this.pa.bind(this);a.cdyUpdate=this.ra.bind(this);a=Da(this.Y*this.L*4);for(var c=0;2>c;c++)this.m[c]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.m[c]),n.pixelStorei(n.UNPACK_ALIGNMENT,1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.Y,this.L,0,n.RGBA,Ea(),a),b.K?n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,
b.S?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_LINEAR):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,b.S?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,b.S?n.LINEAR:n.NEAREST),this.ba[c]=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.ba[c]),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.m[c],0);this.aa=new La(ja.copytexture_v,ja.copytexture_f);b=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,b);b=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,
1,1,0]);a=n.getAttribLocation(this.aa.j,"aPos");n.enableVertexAttribArray(a);c=n.getAttribLocation(this.aa.j,"aTexCoord");n.enableVertexAttribArray(c);var d=new Float32Array([0,0,1,0,0,1,1,1]),f=b.byteLength;n.bufferData(n.ARRAY_BUFFER,f+d.byteLength,n.STATIC_DRAW);n.bufferSubData(n.ARRAY_BUFFER,0,b);n.bufferSubData(n.ARRAY_BUFFER,f,d);n.vertexAttribPointer(a,3,n.FLOAT,!1,0,0);n.vertexAttribPointer(c,2,n.FLOAT,!1,0,f)}
function Ia(a,b){var c=a.j;if(b&&(b.repeat!=c.repeat||b.K!=c.K||b.S!=c.S))for(a.j=b,c=0;2>c;c++)n.bindTexture(n.TEXTURE_2D,a.m[c]),b.K?n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,b.S?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_LINEAR):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,b.S?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,b.S?n.LINEAR:n.NEAREST)}function Ka(a){a.Y=Ga(a.J+a.J/2*(a.j.K&&a.j.repeat));a.L=Ga(a.F+a.F/2*(a.j.K&&a.j.repeat))}
Ja.prototype.bindTexture=function(){n.bindTexture(n.TEXTURE_2D,this.m[this.R])};Ja.prototype.bindFramebuffer=function(){n.bindFramebuffer(n.FRAMEBUFFER,this.ba[this.R^1]);this.R^=1};
Ja.prototype.ra=function(){var a;this.canvas.img.hasOwnProperty("getContext")?a=this.canvas.img.getContext("2d"):(this.canvas.img=document.createElement("canvas"),this.canvas.img.style.display="none",this.canvas.img.width=this.J,this.canvas.img.height=this.F,a=this.canvas.img.getContext("2d"));a.clearRect(0,0,this.J,this.F);this.drawTo(a,0,0);this.canvas.img.generation++};
function Ma(a){if(!(a.canvas.live&&(a.canvas.img.webkitDecodedFrameCount||a.canvas.img.j)&&a.la>=(a.canvas.img.webkitDecodedFrameCount||a.canvas.img.j)||!a.canvas.live&&(!a.canvas.ready||a.generation>=a.canvas.generation))){if(a.J!=a.canvas.width||a.F!=a.canvas.height){a.J=a.canvas.width;a.F=a.canvas.height;Ka(a);for(var b=Da(a.Y*a.L*4),c=0;2>c;c++)n.bindTexture(n.TEXTURE_2D,a.m[c]),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,a.Y,a.L,0,n.RGBA,Ea(),b)}a.bindTexture();n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,1);
a.j.repeat?(m.width=a.Y,m.height=a.L,b=m.getContext("2d"),b.drawImage(a.canvas.img,0,a.L-a.F),b.drawImage(a.canvas.img,a.J,a.L-a.F),b.drawImage(a.canvas.img,0,a.L-2*a.F),b.drawImage(a.canvas.img,a.J,a.L-2*a.F),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,Ea(),m)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,Ea(),a.canvas.img);a.j.K&&n.generateMipmap(n.TEXTURE_2D);n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,0);a.generation=a.canvas.generation;a.la=Math.min(a.la+1,a.canvas.img.webkitDecodedFrameCount||a.canvas.img.j)}}
Ja.prototype.drawTo=function(a,b,c){va(this.J,this.F);n.viewport(0,0,this.Y,this.L);n.useProgram(this.aa.j);n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,this.m[this.R]);this.aa.m.sampler([0]);n.bindFramebuffer(n.FRAMEBUFFER,null);n.drawArrays(n.TRIANGLE_STRIP,0,4);n.flush();a.drawImage(h,0,h.height-this.F,this.J,this.F,b,c,this.J,this.F)};
Ja.prototype.pa=function(a,b,c,d){n.bindFramebuffer(n.FRAMEBUFFER,this.ba[this.R]);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.m[this.R],0);var f=Da(c*d*4);n.readPixels(a,this.F-b-d,c,d,n.RGBA,Ea(),f);a=[];for(--d;0<=d;d--)a=a.concat(Fa(f.slice(d*c*4,(d+1)*c*4)));return a};function Na(a,b){this.C=a;this.R=b;Pa(this)}
function Pa(a){var b=Qa(new Ra(a.C),a.R);a.m=b.D;a.O=b.O;a.ha=b.ha;a.aa=ja.standardFragmentHeader+b.code;a.ba=ja.vshader;a.j=new La(a.ba,a.aa);b=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,b);var b=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),c=n.getAttribLocation(a.j.j,"aPos");n.enableVertexAttribArray(c);a=n.getAttribLocation(a.j.j,"aTexCoord");n.enableVertexAttribArray(a);var d=new Float32Array([0,0,1,0,0,1,1,1]),f=b.byteLength;n.bufferData(n.ARRAY_BUFFER,f+d.byteLength,n.STATIC_DRAW);n.bufferSubData(n.ARRAY_BUFFER,
0,b);n.bufferSubData(n.ARRAY_BUFFER,f,d);n.vertexAttribPointer(c,3,n.FLOAT,!1,0,0);n.vertexAttribPointer(a,2,n.FLOAT,!1,0,f)}
function Sa(a){function b(a,c,d){if(a)if("function"===typeof a)switch(c){case A.h:a([d.value.real,d.value.imag]);break;case A.B:d.value?a([1]):a([0]);break;case A.v:case A.f:a([d.value.real]);break;default:if("list"===c.type&&c.i===A.f)a(d.value.map(function(a){return a.value.real}));else if("list"===c.type&&"list"===c.i.type&&c.i.i===A.f){for(var f=[],q=0;q<c.length;q++)for(var t=0;t<c.i.length;t++)f.push(d.value[q].value[t].value.real);a(f)}else console.error("Don't know how to set uniform of type "+
D(c)+", to "+d)}else if("list"===c.type)if(q=Ta(c),1===E(c)&&q===A.f){c=Ua(c.length);var u=0;for(f in c)b(a["a"+f],A.ca(c[f]),{ctype:"list",value:F(c[f]).map(function(a){return d.value[u+a]})}),u+=c[f]}else for(f=0;f<c.length;f++)b(a["a"+f],c.i,{ctype:"list",value:d.value[f].value});else console.error("Don't know how to set uniform of type "+D(c)+", to"),console.log(d)}for(var c in a.m){var d=a.C.evaluateAndVal(a.m[c].X),f=a.m[c].type;if(!G(Va(d),f)){console.log("Type of "+c+" changed ("+D(Va(d))+
" is no subtype of  "+D(f)+"); forcing rebuild.");Pa(a);n.useProgram(a.j.j);Sa(a);return}a.j.m[c]&&b(a.j.m[c],f,d)}[["rnd_",function(){return[Math.random()]}],["_lowerleft",function(){var b=xa(a.C);return[b.x,b.y]}],["_lowerright",function(){var b=ya(a.C);return[b.x,b.y]}]].map(function(b){return a.j.m[b[0]]&&a.j.m[b[0]](b[1]())})}
function Wa(a){var b=0,c;for(c in a.O){n.activeTexture(n.TEXTURE0+b);var d=a.O[c],f=d.name,d=Xa(d);Ma(d);d.bindTexture();[["_sampler"+f,[b]],["_ratio"+f,[d.J/d.F]],["_cropfact"+f,[d.J/d.Y,d.F/d.L]]].map(function(b){return a.j.m[b[0]]&&a.j.m[b[0]](b[1])});b++}};CindyJS.registerPlugin(1,"CindyGL",function(a){function b(b,d,f,g,k,l){if(!b.na||b.ma<pa)b.na=!0,b.ma=pa,b.qa=new Na(a,b);b=b.qa;var p;a:{for(p in b.ha)if(b.C.getMyfunction(p).generation>b.ha[p]){console.log(p+" is outdated; forcing rebuild.");p=!1;break a}p=!0}p||Pa(b);var q=k/g;p=d.x+-(f.y-d.y)*q;q=d.y+(f.x-d.x)*q;va(g,k);l?n.viewport(0,0,g,k):n.viewport(0,h.height-k,g,k);n.useProgram(b.j.j);Sa(b);d=[f.x-d.x,p-d.x,d.x,f.y-d.y,q-d.y,d.y,0,0,1];b.j.m.hasOwnProperty("transformMatrix")&&b.j.m.transformMatrix([d[0],
d[3],d[6],d[1],d[4],d[7],d[2],d[5],d[8]]);Wa(b);l?(l.bindFramebuffer(),l.generation=++l.canvas.generation):n.bindFramebuffer(n.FRAMEBUFFER,null);n.drawArrays(n.TRIANGLE_STRIP,0,4);n.flush();l&&(l.generation=Math.max(l.generation,l.canvas.generation+1))}r=a.nada;a.defineFunction("compile",1,function(b){b=Qa(new Ra(a),b[0]);console.log(b);return{ctype:"string",value:b}});a.defineFunction("use8bittextures",0,function(){oa=!0;w=v=!1;console.log("Switching to 8-bit textures mode.");return a.nada});a.defineFunction("forcerecompile",
0,function(){pa++;return r});a.defineFunction("colorplot",1,function(c){qa();var d=a.instance.canvas.clientWidth,f=a.instance.canvas.clientHeight,g=a.instance.canvas.width,k=a.instance.canvas.height;b(c[0],xa(a),ya(a),g,k,null);a.instance.canvas.getContext("2d").drawImage(h,0,0,g,k,0,0,d,f);return r});a.defineFunction("colorplot",3,function(c){qa();var d=c[0],f=a.extractPoint(a.evaluateAndVal(c[1])),g=a.extractPoint(a.evaluateAndVal(c[2])),k={x:Math.min(f.x,g.x),y:Math.min(f.y,g.y)},l={x:Math.max(f.x,
g.x),y:Math.min(f.y,g.y)};c=a.instance.canvas.clientWidth;var p=a.instance.canvas.clientHeight,q=a.instance.canvas.width,t=a.instance.canvas.height,u=wa(a,0,0),x=xa(a),H=ya(a),H=Math.abs((f.x-g.x)/(x.x-H.x)),u=Math.abs((f.y-g.y)/(u.y-x.y));b(d,k,l,q*H,t*u,null);d=a.instance.canvas.getContext("2d");k=Math.min(f.x,g.x);f=Math.max(f.y,g.y);g=a.getInitialMatrix();d.drawImage(h,0,0,q*H,t*u,k*g.a-f*g.b+g.tx,k*g.c-f*g.d-g.ty,H*c,u*p);return r});a.defineFunction("colorplot",4,function(c){qa();var d=a.extractPoint(a.evaluateAndVal(c[0])),
f=a.extractPoint(a.evaluateAndVal(c[1])),g=a.evaluateAndVal(c[2]);c=c[3];if(!d.ok||!f.ok||"string"!==g.ctype)return r;var g=a.getImage(g.value,!0),k=Ha(g,!1);b(c,d,f,g.width,g.height,k);return r});a.defineFunction("colorplot",2,function(c){qa();var d=xa(a),f=ya(a),g=a.evaluateAndVal(c[0]);c=c[1];if("string"!==g.ctype)return r;var g=a.getImage(g.value,!0),k=Ha(g,!1);b(c,d,f,g.width,g.height,k);return r});a.defineFunction("setpixel",4,function(b){var d;var f=a.evaluateAndVal(b[0]),g;g=void 0===g?null:
g;"string"===f.ctype?d=f.value:(console.log("argument is not a string"),d=g);f=Ya(a.evaluateAndVal(b[1]));g=Ya(a.evaluateAndVal(b[2]));b=Za(a.evaluateAndVal(b[3]));if(!d)return r;var k=a.getImage(d,!0),k=Ha(k,!1);isFinite(f)&&isFinite(g)&&d&&k&&b&&(k.bindTexture(),d=[b[0],b[1],b[2],1],n.texSubImage2D(n.TEXTURE_2D,0,f,g,1,1,n.RGBA,Ea(),Ca(d)),b=k.canvas.img.getContext("2d"),k=b.createImageData(1,1),k.data.d=d,b.putImageData(k,f,g));return r})});function I(a,b){return{type:"list",length:a,i:b}}function Va(a){return{type:"constant",value:a}}function $a(a){return Va({ctype:"number",value:{real:a,imag:0}})}var A={B:1,v:2,f:3,h:4,W:5,color:6,N:7,V:8,I:9,image:10,M:I(2,3),P:I(3,3),da:I(4,3),ca:function(a){return I(a,3)},ga:function(a){return I(a,4)},ta:I(2,I(2,3)),ua:I(3,I(3,3)),va:I(4,I(4,3))};Object.freeze(A);
function D(a){return 1<=a&&10>=a?"bool int float complex voidt color point line coordinate2d image".split(" ")[a-1]:"list"===a.type?D(a.i)+"["+a.length+"]":"constant"===a.type?"const["+JSON.stringify(a.value.value)+"]":JSON.stringify(a)}function J(a){return"list"===a.type&&J(a.i)||G(a,A.f)}function K(a){return"list"===a.type&&K(a.i)||G(a,A.h)}function ab(a){return"constant"===a.type&&G(a,A.v)}function L(a){return"constant"===a.type?z(a.value):a}function E(a){return"list"===a.type?E(a.i)+1:0}
function Ta(a){return void 0!==a.i?Ta(a.i):a}function bb(a,b){return E(a)===E(b)&&(0===E(a)||a.length===b.length&&bb(a.i,b.i))}function M(a){return G(a,A.f)?A.f:G(a,A.h)?A.h:{type:"list",length:a.length,i:M(a.i)}}function cb(a){return G(a,A.h)?A.h:{type:"list",length:a.length,i:cb(a.i)}}function N(a){return a===A.B||a===A.v||a===A.f||a===A.h||"list"===a.type&&a.i===A.f&&1<=a.length&&4>=a.length||"list"===a.type&&"list"===a.i.type&&a.i.i===A.f&&a.length===a.i.length&&2<=a.length&&4>=a.length}
function db(a){return-1!==[A.B,A.v,A.f,A.h].indexOf(a)}function eb(a,b){return a===b||"constant"===a.type&&"constant"===b.type&&ta(a.value,b.value)||"list"===a.type&&"list"===b.type&&a.length===b.length&&eb(a.i,b.i)}
function G(a,b){return eb(a,b)?!0:a?db(a)&&db(b)?a<=b:"constant"===b.type?!1:"constant"===a.type?G(z(a.value),b):b===A.I?G(a,A.h)||G(a,A.M)||G(a,A.N):b===A.N||b===A.V?G(a,A.P):b===A.color?G(a,A.f)||"list"===a.type&&(3===a.length||4===a.length)&&G(a.i,A.f):"list"===a.type&&"list"===b.type&&a.length===b.length?G(a.i,b.i):!1:!1}
function B(a,b){if(!a)return b;if(!b||eb(a,b))return a;"constant"===a.type&&(a=z(a.value));"constant"===b.type&&(b=z(b.value));return db(a)&&db(b)?Math.max(a,b):"list"===a.type&&"list"===b.type&&a.length===b.length&&(b=B(a.i,b.i))?{type:"list",length:a.length,i:b}:!1}function O(a){return function(b){var c={},d;for(d in a){var f=a[d];c.fa=f[0];if(b.length==c.fa.length&&b.every(function(a){return function(b,c){return G(b,a.fa[c])}}(c)))return{u:c.fa,w:f[1],s:f[2]};c={fa:c.fa}}return!1}}
function fb(a){switch(a){case A.v:return O([[[A.B],A.v,P("int")]]);case A.f:return O([[[A.B],A.f,P("float")],[[A.v],A.f,P("float")]]);case A.h:return O([[[A.f],A.h,function(a){return"vec2("+a+", 0.)"}]]);case A.color:return O([[[A.f],A.color,Q("float2color")],[[A.P],A.color,function(a){return"vec4("+a+",1.0)"}],[[A.da],A.color,R]]);case A.N:return O([[[A.M],A.N,function(a){return"vec3("+a+",1.0)"}],[[A.P],A.N,R]]);case A.V:return O([[[A.M],A.V,function(a){return"vec3("+a+",1.0)"}],[[A.P],A.V,R]]);
case A.I:return O([[[A.h],A.I,R],[[A.M],A.I,R],[[A.N],A.I,Q("dehomogenize")]]);default:if("list"===a.type)return function(b){var c=b[0],d=fb(a.i)([c.i]).s;return{u:b,w:a,s:function(b,g,k){return gb(a)(F(a.length).map(function(a){return d([S(c,a)([b],g,k)],g,k)}),g,k)}}}}console.log("no inclusionfunction ->"+D(a)+" implemented yet; using identity...");return function(b){return{u:b,w:a,s:R}}}
function T(a){switch(a){case A.B:return"bool";case A.v:return"int";case A.f:return"float";case A.h:case A.I:return"vec2";case A.W:return"void";case A.color:return"vec4";case A.N:case A.V:return"vec3"}if("list"===a.type&&a.i===A.f)return 1==a.length?"float":"vec"+a.length;if("list"===a.type&&a.i===A.h)return"cvec"+a.length;if("list"===a.type&&"list"===a.i.type&&a.length===a.i.length&&a.i.i===A.f)switch(a.length){case 2:return"mat2";case 3:return"mat3";case 4:return"mat4"}if("list"===a.type)return"l"+
a.length+"_"+T(a.i);console.error("No WebGL implementation for type "+D(a)+" found")}function hb(a,b){switch(b){case A.B:return T(b)+"("+a.value+")";case A.v:return""+(a.value.real|0);case A.f:return T(b)+"("+a.value.real+")";case A.h:return T(b)+"("+a.value.real+", "+a.value.imag+")";case A.color:return a=a.value.real,"vec4("+a+","+a+","+a+",1.)";default:console.error("Dont know how to paste values of Type "+D(b)+" yet.")}};var U={};function ib(a,b,c){if(!c.mark("includedfunctions",a)){for(var d in U[a])ib(U[a][d],b,c);c.add("includedfunctions",a,function(){return ja[a]})}}function Q(a){return function(b,c,d){ib(a,c,d);return P(a)(b)}};function F(a){return Array.from(Array(a).keys())}function Ua(a){return 4>=a?[a]:5==a?[2,3]:Ua(a-4).concat([4])}function jb(a){var b=Ta(a),c=E(a);return 1==c&&b===A.f?Ua(a.length).map(function(a,b){return{type:A.ca(a),name:"a"+b}}):1<=c?F(a.length).map(function(b){return{type:a.i,name:"a"+b}}):[]}function kb(a,b){if(!N(a)){var c=T(a);b.add("structs",c,function(){return"struct "+c+" { "+jb(a).map(function(a){return kb(a.type,b)||T(a.type)+" "+a.name+";"}).join("")+"};"})}}
function lb(a,b,c){if(!N(a)){var d=a.length,f=a.i.length;c.add("functions","mult"+d+"_"+f,function(){return T(A.ca(d))+" mult"+d+"_"+f+"("+T(a)+" a, "+T(A.ca(f))+" b){return "+mb(d)(F(d).map(function(a){return nb(f)(["a.a"+a,"b"],b,c)}),b,c)+";}"})}}
function ob(a,b,c){if(!N(a)){var d=a.length,f="sum"+T(a);c.add("functions",f,function(){return T(a.i)+" "+f+"("+T(a)+" a){"+(T(a.i)+" res = "+pb(a.i,0)([],b,c)+";\n      "+F(d).map(function(d){return"res = "+qb(a.i)(["res",S(a,d)(["a",d],b,c)],b,c)+";"}).join("\n")+"\n        return res;\n    }")})}}
function rb(a,b,c){var d=a.length,f=a.i.length;c.add("functions","multc"+d+"_"+f,function(){return T(A.ga(d))+" multc"+d+"_"+f+"("+T(a)+" a, "+T(A.ga(f))+" b){\n        return cvec"+d+"("+F(d).map(function(a){return sb(f)(["a.a"+a,"b"],b,c)})+");\n    }\n    "})}function tb(a,b){2<=a&&4>=a||b.add("functions","dot"+a,function(){return"float dot"+a+"(vec"+a+" a, vec"+a+" b) {\n    return "+Ua(a).map(function(a,b){return"dot(a.a"+b+",b.a"+b+")"}).join("+")+"; }\n    "})}
function ub(a,b){b.add("functions","cdot"+a,function(){return"vec2 cdot"+a+"(cvec"+a+" a, cvec"+a+" b) {\n      return "+F(a).map(function(a){return"vec2(dot(a.a"+a+",vec2(b.a"+a+".x,-b.a"+a+".y)), dot(a.a"+a+",b.a"+a+".yx))"}).join("+\n")+";\n    }\n    "})}
function vb(a,b,c){var d="add"+T(a);c.add("functions",d,function(){return T(a)+" "+d+"("+T(a)+" a, "+T(a)+" b) {\n    return "+T(a)+"("+jb(a).map(function(a){return T(a.type)+"("+qb(a.type)(["a."+a.name,"b."+a.name],b,c)+")"}).join(",")+");\n      }"})}
function wb(a,b,c){var d="sub"+T(a);c.add("functions",d,function(){return T(a)+" "+d+"("+T(a)+" a, "+T(a)+" b) {\n    return "+T(a)+"("+jb(a).map(function(a){return T(a.type)+"("+xb(a.type)(["a."+a.name,"b."+a.name],b,c)+")"}).join(",")+");\n    }"})}function yb(a,b,c){var d="scalarmult"+T(a);c.add("functions",d,function(){return T(a)+" "+d+"(float a, "+T(a)+" b) {\n    return "+T(a)+"("+jb(a).map(function(a){return T(a.type)+"("+zb(a.type)(["a","b."+a.name],b,c)+")"}).join(",")+");\n    }"})}
function Ab(a,b,c){ib("multc",b,c);var d="cscalarmult"+T(a);c.add("functions",d,function(){return T(a)+" "+d+"(vec2 a, "+T(a)+" b) {\n    return "+T(a)+"("+jb(a).map(function(a){return""+Bb(a.type)(["a","b."+a.name],b,c)}).join(",")+");\n    }"})}
function Cb(a){if(a===A.h)return Q("multc");if(N(a))return function(a){return V("*")([a[1],a[0]])};var b=Ta(a);if(G(b,A.f))return function(b,d,f){return lb(a,d,f)||"mult"+a.length+"_"+a.i.length+"("+b.join(",")+")"};if(b===A.h)return function(b,d,f){return rb(a,d,f)||"multc"+a.length+"_"+a.i.length+"("+b.join(",")+")"}}function nb(a){return function(b,c,d){return tb(a,d)||"dot"+(2<=a&&4>=a?"":a)+"("+b.join(",")+")"}}
function sb(a){return function(b,c,d){return ub(a,d)||"cdot"+a+"("+b.join(",")+")"}}function qb(a){return N(a)?V("+"):function(b,c,d){return vb(a,c,d)||"add"+T(a)+"("+b.join(",")+")"}}function xb(a){return N(a)?V("-"):function(b,c,d){return wb(a,c,d)||"sub"+T(a)+"("+b.join(",")+")"}}function Db(a){return J(a)&&1==E(a)?function(b,c,d){return nb(a.length)([b[0],mb(a.length)(Array(a.length).fill("1."),c,d)],c,d)}:function(b,c,d){return ob(a,c,d)||"sum"+T(a)+"("+b.join(",")+")"}}
function mb(a){if(2<=a&&4>=a)return function(b){return"vec"+a+"("+b.join(",")+")"};if(1==a)return function(a){return"float("+a.join(",")+")"};var b=0;return function(c,d,f){return kb(A.ca(a),f)||"vec"+a+"("+Ua(a).map(function(a){return"vec"+a+"("+F(a).map(function(){return++b&&c[b-1]}).join(",")+")"}).join(",")+")"}}function gb(a){return N(a)?function(b){return T(a)+"("+b.join(",")+")"}:1==E(a)&&a.i===A.f?mb(a.length):function(b,c,d){return kb(a,d)||T(a)+"("+b.join(",")+")"}}
function S(a,b){var c=Ta(a);return 1==E(a)&&c===A.f?Eb(a.length,b):N(a)?function(a){return"("+a[0]+")["+b+"]"}:function(a){return"("+a[0]+").a"+b}}function pb(a,b){return N(a)?function(){return T(a)+"(float("+b+"))"}:function(c,d,f){return gb(a)+"("+jb(a).map(function(a){return pb(a.type,b)(c,d,f)}).join(",")+")"}}
function Eb(a,b){return function(c){if(1==a)return c[0];if(2<=a&&4>=a)return"("+c[0]+")["+b+"]";var d;a:{d=b;var f=Ua(a),g;for(g in f)if(f[g]<=d)d-=f[g];else{d={first:g,second:d};break a}console.error("Accessing index out of range");d=void 0}return"("+c[0]+").a"+d.first+"["+d.second+"]"}}function zb(a){return N(a)?V("*"):function(b,c,d){return yb(a,c,d)||"scalarmult"+T(a)+"("+b.join(",")+")"}}
function Bb(a){return a===A.h?Q("multc"):function(b,c,d){return Ab(a,c,d)||"cscalarmult"+T(a)+"("+b.join(",")+")"}}function Fb(a,b,c){var d="reverse"+T(a);c.add("functions",d,function(){return T(a)+" "+d+"("+T(a)+" a){"+(T(a.i)+" m;\n")+F(Math.floor(a.length/2)).map(function(d){var g=S(a,d)(["a",d],b,c);d=S(a,a.length-1-d)(["a",a.length-1-d],b,c);return"m = "+g+"; "+g+" = "+d+"; "+d+" = m;"}).join("\n")+"return a;\n      }"})}
function Gb(a){return function(b,c,d){return Fb(a,c,d)||"reverse"+T(a)+"("+b.join(",")+")"}}function Hb(a,b,c){var d="max"+T(a);c.add("functions",d,function(){return T(a.i)+" "+d+"("+T(a)+" a){"+(T(a.i)+" m = "+S(a,a.length-1)(["a",a.length-1],b,c)+";\n")+F(a.length-1).map(function(d){return"m = max(m,"+S(a,d)(["a",d],b,c)+");"}).join("\n")+"return m;\n      }"})}function Ib(a){return function(b,c,d){return Hb(a,c,d)||"max"+T(a)+"("+b.join(",")+")"}}
function Jb(a,b,c){var d="min"+T(a);c.add("functions",d,function(){return T(a.i)+" "+d+"("+T(a)+" a){"+(T(a.i)+" m = "+S(a,a.length-1)(["a",a.length-1],b,c)+";\n")+F(a.length-1).map(function(d){return"m = min(m,"+S(a,d)(["a",d],b,c)+");"}).join("\n")+"return m;\n      }"})}function Kb(a){return function(b,c,d){return Jb(a,c,d)||"min"+T(a)+"("+b.join(",")+")"}};function Lb(a){function b(a,d,k){if(1<d){var l=d/2|0;b(a,l,!k);b(a+l,d-l,k);c(a,d,k)}}function c(a,b,k){if(1<b){var l;for(l=1;l<b;)l<<=1;l>>=1;for(var p=a;p<a+b-l;p++){var q=p,t=p+l;k?d.push([q,t]):d.push([t,q])}c(a,l,k);c(a+l,b-l,k)}}var d=[];b(0,a,!0);return d}
function Mb(a,b,c){var d="sort"+T(a);c.add("functions",d,function(){return T(a)+" "+d+"("+T(a)+" a){"+(T(a.i)+" m;\n")+Lb(a.length).map(function(d){var g=S(a,d[0])(["a",d[0]],b,c);d=S(a,d[1])(["a",d[1]],b,c);return"m = min("+g+","+d+"); "+d+" = max("+g+","+d+"); "+g+" = m;"}).join("\n")+"return a;\n      }"})}function Nb(a){return function(b,c,d){return Mb(a,c,d)||"sort"+T(a)+"("+b.join(",")+")"}};function P(a){return function(b){return y(a)+"("+b+")"}}function V(a){return function(b){return"("+b.join(a)+")"}}function R(a){return a}var W={};W.join=O([[[A.N,A.N],A.V,P("cross")]]);W.meet=O([[[A.V,A.V],A.N,P("cross")]]);W.gauss=O([[[A.h],A.M,R]]);W.complex=O([[[A.M],A.h,R]]);
W["if"]=function(a){if(!a.every(function(a){return a}))return!1;if(2===a.length)return{u:a,w:a[1],s:function(a){return"if("+a[0]+") {"+a[1]+";}"}};if(3===a.length){var b=B(a[1],a[2]);return b?{u:[A.B,b,b],w:b,s:function(a){return"("+a[0]+" ? "+a[1]+" : "+a[2]+")"}}:{u:a,w:A.W,s:function(a){return"if("+a[0]+") {"+a[1]+";} else {"+a[2]+";}"}}}return!1};W["="]=function(a){a=B(a[0],a[1]);return{u:a,w:a,s:function(a){return a[0]+" = "+a[1]+";"}}};
W[";"]=function(a){return{u:a,w:a[1]!==A.W?a[1]:a[0],s:function(a){return a[0]+" ; "+a[1]+";"}}};W.repeat=function(a){return 2!=a.length&&3!=a.length||!ab(a[0])?!1:{u:a,w:a[a.length-1],s:function(){return""}}};W.forall=function(a){return 2!=a.length&&3!=a.length||"list"!==L(a[0]).type?!1:{u:a,w:a[a.length-1],s:function(){return""}}};W.apply=function(a){return 2!=a.length&&3!=a.length||"list"!==L(a[0]).type?!1:{u:a,w:I(L(a[0]).length,a[a.length-1]),s:function(){return""}}};
W.sum=function(a){return 1==a.length&&(J(a[0])||K(a[0]))?{u:a,w:a[0].i,s:Db(a[0])}:!1};W.regional=function(a){return{u:a,w:A.W,s:function(){return""}}};W.sqrt=O([[[A.f],A.h,Q("sqrtf")],[[A.h],A.h,Q("sqrtc")]]);W.abs=O([[[A.f],A.f,P("abs")],[[A.h],A.f,P("length")],[[A.M],A.f,P("length")],[[A.P],A.f,P("length")],[[A.da],A.f,P("length")]]);W.abs_infix=W.abs;
W.dist=O([[[A.f,A.f],A.f,function(a){return P("abs")(V("-")(a))}],[[A.h,A.h],A.f,function(a){return P("length")(V("-")(a))}],[[A.M,A.M],A.f,function(a){return P("length")(V("-")(a))}],[[A.P,A.P],A.f,function(a){return P("length")(V("-")(a))}],[[A.da,A.da],A.f,function(a){return P("length")(V("-")(a))}]]);W.dist_infix=W.dist;W.sin=O([[[A.f],A.f,P("sin")],[[A.h],A.h,Q("sinc")]]);W.cos=O([[[A.f],A.f,P("cos")],[[A.h],A.h,Q("cosc")]]);W.tan=O([[[A.f],A.f,P("tan")],[[A.h],A.h,Q("tanc")]]);
W.exp=O([[[A.f],A.f,P("exp")],[[A.h],A.h,Q("expc")]]);W.arctan=O([[[A.f],A.f,P("atan")],[[A.h],A.h,Q("arctanc")]]);W.arcsin=O([[[A.f],A.h,Q("arcsinf")],[[A.h],A.h,Q("arcsinc")]]);W.arccos=O([[[A.f],A.h,Q("arccosf")],[[A.h],A.h,Q("arccosc")]]);W.log=O([[[A.f],A.h,Q("logr")],[[A.h],A.h,Q("logc")]]);var Ob=[2,3,4].map(function(a){return I(a,A.f)}).concat([2,3,4].map(function(a){return I(a,I(a,A.f))})),Pb=[A.v,A.f,A.h].concat(Ob);
W.add=function(a){var b=O(Pb.map(function(a){return[[a,a],a,V("+")]}))(a);if(b)return b;b=a[0];a=a[1];if([b,a].every(function(a){return J(a)||K(a)})&&bb(b,a))return a=B(M(b),M(a)),{u:[a,a],w:a,s:qb(a)}};W.sub=function(a){var b=O(Pb.map(function(a){return[[a,a],a,V("-")]}).concat(Pb.map(function(a){return[[A.W,a],a,V("-")]})))(a);if(b)return b;b=a[0];a=a[1];if([b,a].every(function(a){return J(a)||K(a)})&&bb(b,a))return a=B(M(b),M(a)),{u:[a,a],w:a,s:xb(a)}};W["+"]=W.add;W["-"]=W.sub;
W._=function(a){var b=L(a[0]);if("list"===b.type&&ab(a[1])){var c=Number(a[1].value.value.real);return 1<=Math.abs(c)&&Math.abs(c)<=b.length?(0<c&&--c,0>c&&(c=b.length+c),{u:a,w:b.i,s:S(b,c)}):{u:a,w:b.i,s:function(){return console.error("try to access "+c+"-th Element of "+b.length+"-list "+JSON.stringify(a[0]))}}}return!1};
W.mult=function(a){var b=O([[[A.v,A.v],A.v,V("*")],[[A.f,A.f],A.f,V("*")],[[A.h,A.f],A.h,V("*")],[[A.f,A.h],A.h,V("*")],[[A.h,A.h],A.h,Q("multc")]])(a);if(b)return b;if(2!==a.length)return!1;var b=a[0],c=a[1];if([b,c].every(function(a){return"list"===a.type&&G(a.i,A.f)})&&b.length===c.length)return a=M(b),N(a)?{u:[a,a],w:A.f,s:P("dot")}:{u:[a,a],w:A.f,s:nb(b.length)};if([b,c].every(function(a){return"list"===a.type&&G(a.i,A.h)})&&b.length===c.length)return a=cb(b),{u:[a,a],w:A.h,s:sb(b.length)};if(J(b)&&
2===E(b)&&J(c)&&1===E(c)&&b.i.length===c.length)return{u:[M(b),M(c)],w:A.ca(b.length),s:Cb(M(b))};if(K(b)&&2===E(b)&&K(c)&&1===E(c)&&b.i.length===c.length)return{u:[cb(b),cb(c)],w:A.ga(b.length),s:Cb(cb(b))};for(b={G:0};2>b.G;b={Z:b.Z,G:b.G,ea:b.ea},b.G++){if(G(a[0^b.G],A.f)&&(J(a[1^b.G])||K(a[1^b.G])))return b.Z=M(a[1^b.G]),{u:b.G?[b.Z,A.f]:[A.f,b.Z],w:b.Z,s:function(a){return function(b,c,k){return zb(a.Z)([b[0^a.G],b[1^a.G]],c,k)}}(b)};if(G(a[0^b.G],A.h)&&K(a[1^b.G]))return b.ea=cb(a[1^b.G]),{u:b.G?
[b.ea,A.h]:[A.h,b.ea],w:b.ea,s:function(a){return function(b,c,k){return Bb(a.ea)([b[0^a.G],b[1^a.G]],c,k)}}(b)}}};W["*"]=W.mult;W.div=function(a){var b=O([[[A.f,A.f],A.f,V("/")],[[A.f,A.h],A.h,Q("divfc")],[[A.h,A.f],A.h,V("/")],[[A.h,A.h],A.h,Q("divc")]])(a);return b?b:G(a[1],A.f)&&K(a[0])&&(a=M(a[0]),N(a))?{u:[a,A.f],w:a,s:V("/")}:!1};W["/"]=W.div;W.re=O([[[A.h],A.f,Q("realc")]]);W.im=O([[[A.h],A.f,Q("imagc")]]);W.floor=O([[[A.f],A.v,function(a){return"int(floor("+a+"))"}],[[A.h],A.h,P("floor")]]);
W.round=O([[[A.f],A.v,function(a){return"int(floor("+a+"+.5))"}],[[A.h],A.h,function(a){return"floor("+a+"+vec2(.5))"}]]);W.ceil=O([[[A.f],A.v,function(a){return"int(ceil("+a+"))"}],[[A.h],A.h,P("ceil")]]);W.mod=O([[[A.v,A.v],A.v,function(a,b){return"int("+P("mod")("float("+a[0]+"), float("+a[1]+")",b)+")"}],[[A.f,A.f],A.f,P("mod")],[[A.h,A.h],A.h,Q("mod")]]);
W.random=O([[[],A.f,Q("random")],[[A.f],A.f,function(a,b,c){return Q("random")([],b,c)+"*"+a[0]}],[[A.h],A.h,function(a,b,c){return"vec2("+Q("random")([],b,c)+","+Q("random")([],b,c)+")*"+a[0]}]]);W.randomint=O([[[A.v],A.v,function(a,b,c){return"int(floor("+Q("random")([],b,c)+"*float("+a[0]+")))"}],[[A.f],A.v,function(a,b,c){return"int(floor("+Q("random")([],b,c)+"*floor("+a[0]+")))"}]]);W.randominteger=W.randomint;W.randombool=O([[[],A.B,function(a,b,c){return"("+Q("random")([],b,c)+">.5)"}]]);
W.randomnormal=O([[[],A.f,Q("randomnormal")]]);W.arctan2=O([[[A.f,A.f],A.f,function(a){return"atan("+a[1]+", "+a[0]+")"}],[[A.h,A.h],A.h,Q("arctan2c")],[[A.h],A.f,Q("arctan2vec2")],[[A.M],A.f,Q("arctan2vec2")],[[A.ga(2)],A.h,Q("arctan2cvec2")]]);["red","green","blue","gray","hue"].forEach(function(a){W[a]=O([[[A.f],A.P,Q(a)]])});W.grey=W.gray;W.min=function(a){var b=O([[[A.f,A.f],A.f,P("min")]])(a);if(b)return b;if(1===a.length&&1===E(a[0])&&J(a[0]))return{u:a,w:a[0].i,s:Kb(a[0])}};
W.max=function(a){var b=O([[[A.v,A.v],A.v,P("max")],[[A.f,A.f],A.f,P("max")]])(a);if(b)return b;if(1===a.length&&1===E(a[0])&&J(a[0]))return{u:a,w:a[0].i,s:Ib(a[0])}};function Qb(a,b){if(!(1>=a))if(2==a)b.add("functions","raise2",function(){return"float raise2(float a) { return a*a; }"});else{Qb(2,b);var c=function(a,b){return 1==b?a:b&1?c(a,b-1)+"*a":"raise2("+c(a,b/2)+")"},d="raise"+a;b.add("functions",d,function(){return"float "+d+"(float a) { return "+c("a",a)+";}"})}}
function Rb(a){return function(b,c,d){return 0==a?"1.":1==a?b[0]:Qb(a,d)||"raise"+a+"("+b[0]+")"}}W.pow=function(a){if(ab(a[1])&&G(a[0],A.f)){var b=Number(a[1].value.value.real);if(0<=b)return{u:[A.f,a[1]],w:A.f,s:Rb(b)}}return O([[[A.f,A.v],A.f,Q("powi")],[[A.h,A.h],A.h,Q("powc")]])(a)};W["^"]=W.pow;W.re=O([[[A.h],A.f,function(a){return"("+a+").x"}]]);W.conjugate=O([[[A.h],A.h,Q("conjugate")]]);W.im=O([[[A.h],A.f,function(a){return"("+a+").y"}]]);
W.genList=function(a){var b=a.length;if(0<b){var c=!1,d;for(d in a)c=B(c,a[d]);if(c)return a=I(b,c),{u:Array(b).fill(c),w:a,s:gb(a)}}return!1};W["&"]=O([[[A.B,A.B],A.B,V("&&")]]);W["%"]=O([[[A.B,A.B],A.B,V("||")]]);"> < >= <= == !=".split(" ").forEach(function(a){W[a]=O([[[A.v,A.v],A.B,V(a)],[[A.f,A.f],A.B,V(a)]])});W["!"]=O([[[A.B],A.B,P("!")],[[A.W,A.B],A.B,function(a){return P("!")([a[1]])}]]);W.not=W["!"];W.imagergb=O([[[A.image,A.I],A.P,Sb],[[A.I,A.I,A.image,A.I],A.P,Tb]]);
W.imagergba=O([[[A.image,A.I],A.da,Ub],[[A.I,A.I,A.image,A.I],A.da,Vb]]);W.reverse=function(a){return 1===a.length&&"list"===a[0].type?{u:a,w:a[0],s:Gb(a[0])}:!1};W.sort=function(a){return 1===a.length&&1===E(a[0])&&J(a[0])?{u:a,w:a[0],s:Nb(a[0])}:!1};Object.freeze(W);U.powc=["expc","multc","logc"];U.sqrtc=["expc","multc","logc"];U.arccosc=["multc","negc","sqrtc","addc","logc"];U.arcsinc=["multc","negc","sqrtc","addc","logc"];U.tanc=["sinc","cosc","divc"];U.arctanc=["logc","addc","multc","subc"];
U.arctan2c=["logc","divc","sqrtc","multc"];U.arctan2vec2c=["arctan2c"];U.hue=["hsv2rgb"];U.randomnormal=["random"];Object.freeze(U);function Ra(a){this.l={};this.D={};this.j={};this.T=0;this.m={};this.C=a;this.O={}}Ra.prototype.add=function(a,b,c){this.mark(a,b);this.j[a].ja[b]||(this.j[a].ja[b]=c(),this.j[a].ia[b]=!0,this.j[a].order.push(b))};Ra.prototype.mark=function(a,b){this.j[a]||(this.j[a]={order:[],ia:{},ja:{}});var c=this.j[a].ia[b]||!1;this.j[a].ia[b]=!0;return c};function Wb(a,b){return a.j[b]?a.j[b].order.map(function(c){return a.j[b].ja[c]}).join("\n"):"\n"}
function Xb(a,b,c,d){if(eb(c,d))return b;if(G(c,d)){if("constant"===c.type)return hb(c.value,d);var f=fb(d)([c]);if(!f)return console.error("cannot find an implementation for "+D(c)+" -> "+D(d)+", using identity"),b;d=f.s;return d(Xb(a,b,c,f.u[0]),{},a)}console.error(D(c)+" is no subtype of "+D(d)+" (trying to cast the term "+b+")");return b}function X(a,b,c){a.l[b]||(a.l[b]={});a.l[b].U||(a.l[b].U=[]);a.l[b].A||(a.l[b].A=!1);a.hasOwnProperty("global")||(a.l[b].global=c)}
function Yb(a,b){var c=b.H;if(b.isuniform)return a.D[b.uvariable].type;if("variable"===b.ctype)return b=b.name,b=c[b]||b,a.l[b].A;if("function"===b.ctype&&a.m.hasOwnProperty(b.oper))return a.l[c[b.oper]].A;if("number"===b.ctype)return Va(b);if("void"===b.ctype)return A.W;if("field"===b.ctype){a=L(Y(a,b.obj));if("list"===a.type)return a.i;if(!a)return!1}else{if("string"===b.ctype)return A.image;if("function"===b.ctype||"infix"===b.ctype){for(var c=Array(b.args.length),d=!0,f=0;f<b.args.length;f++)c[f]=
Y(a,b.args[f]),d&="constant"===c[f].type;if(d&&b.impl)return b={ctype:b.ctype,oper:b.oper,impl:b.impl,args:c.map(function(a){return a.value})},b=a.C.evaluateAndVal(b),Va(b);a=y(b.oper);d=W[a]?W[a](c):!1;if(!d&&c.every(function(a){return Ta(a)}))throw console.error("Could not find an implementation for "+a+" with args ("+c.map(D).join(", ")+")"),console.log(b),"error";return d?d.w:!1}}console.error("Don't know how to compute type of");console.log(b);return!1}
function Y(a,b){if(!b.ka||!b.T||a.T>b.T)b.ka=Yb(a,b),b.T=a.T;return b.ka}
function Zb(a,b,c){function d(a,b,c){var d={},f;for(f in a)d[f]=a[f];a=C();X(l,a,!1);g[a].A=c;g[a].oa=!0;d[b]=a;return d}function f(a,b,c,u){a.H=b;for(var x in a.args){var H=u||"repeat$2"===a.oper&&0==x||"repeat$3"===a.oper&&0==x||"_"===a.oper&&1==x,Oa=b;-1!=["repeat","forall","apply"].indexOf(y(a.oper))&&(1==x?Oa="repeat$2"===a.oper?d(b,"#",A.v):"repeat$3"===a.oper?d(b,a.args[1].name,A.v):"forall$2"===a.oper||"apply$2"===a.oper?d(b,"#",!1):"forall$3"===a.oper||"apply$3"===a.oper?d(b,a.args[1].name,
!1):b:2==x&&(Oa=a.args[1].H));f(a.args[x],Oa,c,H)}"field"===a.ctype&&f(a.obj,b,c,u);"variable"===a.ctype&&(x=a.name,x=b[x]||x,u&&l.l[x]&&(l.l[x].$=!0));if("="===a.oper)u=a.args[0].name,u=b[u]||u,X(l,u,!0),g[u].U.push(a.args[1]);else if(a.oper&&"regional"===y(a.oper)&&"global"!=c)for(var ka in a.args){u=a.args[ka].name;var la=C();b[u]=la;k[c].l||(k[c].l=[]);k[c].l.push(la);X(l,la,!1)}else if("forall$2"===a.oper||"apply$2"===a.oper||"forall$3"===a.oper||"apply$3"===a.oper)g[2===a.args.length?a.args[1].H["#"]:
a.args[2].H[a.args[1].name]].U.push({ctype:"infix",oper:"_",args:[a.args[0],{ctype:"number",value:{real:1,imag:0}}],H:a.args[0].H});else if("function"===a.ctype&&k.hasOwnProperty(a.oper)){c=a.oper;ka=c.replace("$","_");X(l,ka,!1);b[c]=ka;b={};for(la in k[c].arglist)x=k[c].arglist[la].name,H=ka+"_"+x,b[x]=H,X(l,H,!1),g[H].U.push(a.args[la]);k[c].sa||(k[c].sa=!0,f(k[c].body,b,c,u),g[ka].U.push(k[c].body))}}var g=a.l,k=a.m,l=a;f(b,c,"global",!1)}
function $b(a,b){function c(a){if(a.hasOwnProperty("dependsOnPixel"))return a.dependsOnPixel;if("variable"===a.ctype){var b=a.name,b=a.H[b]||b;return k[b]?a.dependsOnPixel=!0:a.dependsOnPixel=!1}b="random randomint randominteger randombool randomnormal verbatimglsl".split(" ");if("function"===a.ctype&&-1!=b.indexOf(y(a.oper)))return a.dependsOnPixel=!0;if("repeat$2"===a.oper||"forall$2"===a.oper||"apply$2"===a.oper)return c(a.args[1])?(k[a.args[1].H["#"]]=!0,a.dependsOnPixel=!0):a.dependsOnPixel=
!1;if("repeat$3"===a.oper||"forall$3"===a.oper||"apply$3"===a.oper)return c(a.args[2])?(k[a.args[2].H[a.args[1].name]]=!0,a.args[1].dependsOnPixel=!0,a.dependsOnPixel=!0):a.dependsOnPixel=!1;for(var d in a.args)if(c(a.args[d]))return a.dependsOnPixel=!0;return"function"===a.ctype&&g.hasOwnProperty(a.oper)&&c(g[a.oper].body)?a.dependsOnPixel=!0:"field"===a.ctype?a.dependsOnPixel=c(a.obj):a.dependsOnPixel=!1}function d(a,b){if(c(a)){for(var f in a.args)d(a.args[f],b||"repeat$2"===a.oper&&0==f||"repeat$3"===
a.oper&&0==f||"_"===a.oper&&1==f);"field"===a.ctype&&d(a.obj,b);"function"===a.ctype&&g.hasOwnProperty(a.oper)&&(a=a.oper,p.hasOwnProperty(a)||(p[a]=!0,d(g[a].body,b)))}else if("boolean"!==a.ctype&&"number"!==a.ctype&&"void"!==a.ctype){".."===a.oper&&(b=!0);f=!1;var k,l;for(l in q)!f&&ta(a,q[l].X)&&(f=!0,k=l);f||(k=C(),q[k]={X:a,type:!1,$:b});q[k].$=q[k].$||b;a.isuniform=!0;a.uvariable=k}}var f=a.l,g=a.m,k={cgl_pixel:!0,"cgl_pixel.x":!0,"cgl_pixel.y":!0},l;for(l in f)if(1<=f[l].U.length||f[l].oa)k[l]=
!0;c(b);var p={"":!0},q=a.D;d(b,!1)}function ac(a,b){if("function"===b.ctype&&!a.m.hasOwnProperty(b.oper)&&null!==a.C.getMyfunction(b.oper)){var c=b.oper;a.m[c]=sa(a.C.getMyfunction(c));ac(a,a.m[c].body)}for(var d in b.args)ac(a,b.args[d])}
function bc(a,b){function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function d(a,b){"repeat$2"===a.oper||"forall$2"===a.oper||"apply$2"===a.oper?(b=c(b),b["#"]=!0):"repeat$3"===a.oper||"forall$3"===a.oper||"apply$3"===a.oper?(b=c(b),b[a.args[1].name]=!0):"="===a.oper&&(b[a.args[0].name]=!0);for(var f in a.args)d(a.args[f],b);"field"===a.ctype&&d(a.obj,b);"variable"===a.ctype&&(a=a.name,b[a]||(g[a]=!0))}var f={},g={};d(b,{});X(a,"cgl_pixel",!1);a.l.cgl_pixel.A=A.M;if(1==Object.keys(g).length)f[Object.keys(g)[0]]=
"cgl_pixel";else if(g["#"])f["#"]="cgl_pixel";else if(g.x&&g.y)X(a,"cgl_pixel.x",!1),a.l["cgl_pixel.x"].A=A.f,f.x="cgl_pixel.x",X(a,"cgl_pixel.y",!1),a.l["cgl_pixel.y"].A=A.f,f.y="cgl_pixel.y";else{b=[];for(var k in g)a.C.nada==a.C.evaluateAndVal({ctype:"variable",name:k})&&b.push(k);1==b.length?f[b[0]]="cgl_pixel":g.p?f.p="cgl_pixel":g.z&&(f.z="cgl_pixel")}"cgl_pixel"===f.z&&(a.l.cgl_pixel.A=A.h);return f}
function Z(a,b,c){var d=Y(a,b);if(b.isuniform)return b=b.uvariable,c?{code:"",o:"constant"===d.type?hb(d.value,L(d)):b}:{code:""};if(";"===b.oper){for(var d={o:""},f="",g=b.args.length-1,k=g;0<=k;k--)"void"===b.args[k].ctype&&(g=k-1);for(k=0;k<=g;k++)d=Z(a,b.args[k],c&&k===g),f+=d.code;return c?{code:f,o:d.o}:{code:f}}if("constant"===d.type)return c?{o:hb(d.value,L(d)),code:""}:{code:""};if("="===b.oper)return d=Z(a,b.args[1],!0),b=Z(a,b.args[0],!0).o+" = "+Xb(a,d.o,Y(a,b.args[1]),Y(a,b.args[0])),
c?{code:d.code,o:b}:{code:d.code+b+";\n"};if("repeat$2"===b.oper||"repeat$3"===b.oper){f=Z(a,b.args[0],!0);if("constant"!==Y(a,b.args[0]).type)return console.error("repeat possible only for fixed constant number in GLSL"),!1;d="repeat$2"===b.oper?b.args[1].H["#"]:b.args[2].H[b.args[1].name];f=Number(f.o);g="";if("constant"===a.l[d].A.type)for(k=1;k<=f;k++){a.l[d].A=$a(k);a.T++;var l=Z(a,b.args["repeat$2"===b.oper?1:2],k===f&&c),g=g+l.code;if(k===f&&c)return{code:g,o:l.o}}else if(k="",l=Z(a,b.args["repeat$2"===
b.oper?1:2],c),b=Y(a,b.args["repeat$2"===b.oper?1:2]),c&&(k=C(),a.l[k]||(X(a,k,!0),a.l[k].A=b)),g=g+("for(int "+d+"=1; "+d+" <= "+f+"; "+d+"++) {\n")+l.code,c&&(g+=k+" = "+l.o+";\n"),g+="}\n",c)return{code:g,o:k};return{code:g}}if("forall$2"===b.oper||"forall$3"===b.oper||"apply$2"===b.oper||"apply$3"===b.oper){var p=Y(a,b.args[0]);if("list"!==p.type&&("constant"!==p.type||"list"!==p.value.ctype))return console.error(b.oper+" only possible for lists"),!1;var f=p.length||p.value.value.length,k=2===
b.args.length?b.args[1].H["#"]:b.args[2].H[b.args[1].name],q=a.l[k].A,t=l="";c&&(t=C(),l+=T(d)+" "+t+";\n");"list"===d.type&&kb(d,a);if("constant"===a.l[k].A.type||"constant"===p.type)for(p=a.C.evaluateAndVal(b.args[0]),q=0;q<f;q++)a.l[k].A=Va(p.value[q]),a.T++,g=Z(a,b.args[2===b.args.length?1:2],c),l+=g.code,"forall$2"===b.oper||"forall$3"===b.oper?q+1===f&&c&&(l+=t+" = "+g.o+";\n"):c&&(l+=S(d,q)([t],[],a)+" = "+g.o+";\n");else{var g=Z(a,b.args[2===b.args.length?1:2],c),u=Z(a,b.args[0],!0),l=l+u.code,
x=u.o;!a.l[x]&&!a.D[x]&&2<=p.length&&(x=C(),l+=T(p)+" "+x+" = "+u.o+";\n");a.l[k].global=!0;for(u=0;u<f;u++)l+=k+" = "+S(p,u)([x],[],a)+";\n",l+=g.code,c&&("forall$2"===b.oper||"forall$3"===b.oper?u===f-1&&(l+=t+" = "+g.o+";\n"):l+=S(d,u)([t],[],a)+" = "+g.o+";\n");"list"===q.type&&kb(q,a)}return c?{code:l,o:t}:{code:l}}if("if$2"===b.oper||"if$3"===b.oper){l=Z(a,b.args[0],!0);f=Y(a,b.args[0]);k=g="";t=Z(a,b.args[1],c);c&&(k=C(),a.l[k]||(X(a,k,!0),a.l[k].A=d));"constant"!=f.type&&(g+=l.code,g+="if("+
l.o+") {\n");if("constant"!=f.type||"constant"==f.type&&f.value.value)g+=t.code,c&&(g+=k+" = "+Xb(a,t.o,Y(a,b.args[1]),d)+";\n");"if$3"===b.oper&&(l=Z(a,b.args[2],c),"constant"!=f.type&&(g+="} else {\n"),"constant"!=f.type||"constant"==f.type&&!f.value.value)&&(g+=l.code,c&&(g+=k+" = "+Xb(a,l.o,Y(a,b.args[2]),d)+";\n"));"constant"!=f.type&&(g+="}\n");return c?{code:g,o:k}:{code:g}}if("function"===b.ctype||"infix"===b.ctype){l=b.oper;if("verbatimglsl"===y(l))return b=a.C.evaluateAndVal(b.args[0]).value,
c?{o:b,code:""}:{code:b};d=b.args.map(function(b){return Z(a,b,!0)});f=b.args.map(function(b){return Y(a,b)});if(a.m.hasOwnProperty(l))for(k=cc(a,l),g=Array(d.length),t=0;t<d.length;t++)g[t]=a.l[a.m[l].body.H[a.m[l].arglist[t].name]].A;else{l=y(l);if("regional"===l)return c?{o:"",code:""}:{code:""};k=W[l](f);if(!k)return console.error("Could not find an implementation for "+l+"("+f.map(D).join(", ")+").\nReturning empty code"),c?{o:"",code:""}:{code:""};g=k.u;k=k.s}l="";t=Array(d.length);for(p=0;p<
d.length;p++)l+=d[p].code,t[p]=Xb(a,d[p].o,f[p],g[p]);b=k(t,b.modifs,a);return c?{o:b,code:l}:{code:l+b+";\n"}}if("variable"===b.ctype)return d=b.name,d=b.H[d]||d,c?{o:d,code:""}:{code:d+";\n"};if("void"===b.ctype)return c?{o:"",code:""}:{code:""};if("field"===b.ctype&&(d={x:0,y:1,z:2,r:0,g:1,b:2,a:3}[b.key],void 0!=d))return b=S(Y(a,b.obj),d)([Z(a,b.obj,!0).o],null,a),c?{o:b,code:""}:{code:b+";\n"};console.error("dont know how to this.compile "+JSON.stringify(b))}
function cc(a,b){dc(a,b,a.m[b].arglist.length);return P(b.replace("$","_"))}
function dc(a,b,c){if(!a.mark("compiledfunctions",b)){for(var d=a.m[b],f=b.replace("$","_"),g=d.body.H,k=Array(c),l=0;l<c;l++)k[l]=d.arglist[l].name;c=a.l[f].A===A.W;var p=T(a.l[f].A)+" "+f+"("+k.map(function(b){return T(a.l[g[b]].A)+" "+g[b]}).join(", ")+"){\n",q;for(q in d.l)k=d.l[q],p+=T(a.l[k].A)+" "+k+";\n";q=Z(a,d.body,!c);d=Y(a,d.body);p+=q.code;c||(p+="return "+Xb(a,q.o,d,a.l[f].A)+";\n");p+="}\n";a.add("compiledfunctions",b,function(){return p})}}
function Qa(a,b){ua=0;var c=b=sa(b);ac(a,c);Zb(a,c,bc(a,c));$b(a,c);for(var d in a.D){c=a.C.evaluateAndVal(a.D[d].X);if(!c.ctype||"undefined"===c.ctype){console.error("can not evaluate:");console.log(a.D[d].X);break}a.D[d].type=a.D[d].$?Va(c):z(c)}d=!0;for(var f in a.l)a.l[f].A=a.l[f].A||!1,a.l[f].$&&(a.l[f].A=$a(1),a.T++);for(;d;){d=!1;for(var g in a.l)if(!a.l[g].$)for(var k in a.l[g].U){f=L(Y(a,a.l[g].U[k]));var l=c=a.l[g].A||!1;f&&(c?G(f,c)?l=c:l=B(c,f):l=f,l&&l!==c&&(a.l[g].A=l,a.T++,d=!0))}}for(var p in a.D)"list"===
a.D[p].type.type&&kb(a.D[p].type,a);for(var q in a.l)"list"===a.l[q].A.type&&kb(a.l[q].A,a);g=Z(a,b,!0);k=Y(a,b);b=Xb(a,g.o,k,A.color);G(k,A.color)||console.error("expression does not generate a color");k=Wb(a,"structs");k+=Wb(a,"uniforms");p=[];for(var t in a.D)"constant"!=a.D[t].type.type&&a.D[t].type!=A.image&&p.push("uniform "+T(a.D[t].type)+" "+t+";");k+=p.join("\n");t="";for(var u in a.O)t+=a.O[u].code+"\n";k=k+t+Wb(a,"includedfunctions");k+=Wb(a,"functions");for(var x in a.l)a.l[x].A&&a.l[x].global&&
(k+=T(a.l[x].A)+" "+x+";\n");k+=Wb(a,"compiledfunctions");k+="void main(void) {\n"+g.code+"gl_FragColor = "+b+";\n}\n";console.log(k);u={};if(a.j.compiledfunctions)for(var H in a.j.compiledfunctions.ia)u[H]=a.C.getMyfunction(H).generation;return{code:k,D:a.D,O:a.O,ha:u}};function ec(a,b,c,d){this.X=b;this.C=d;this.m=c;fc(this);b=this.j;this.name=a;this.code="uniform sampler2D _sampler"+a+";\nuniform float _ratio"+a+";\nuniform vec2 _cropfact"+a+";\nvec4 _imagergba"+a+"(vec2 A, vec2 B, vec2 p) {\n  p -= A; B -= A;\n  float b = dot(B,B);\n  p = vec2(dot(p,B),_ratio"+a+"*dot(p,vec2(-B.y,B.x)))/b;\n  "+(b.repeat?"p = mod(p, vec2(1.));":"")+"\n  "+(b.repeat&&b.K?"vec4 color = vec4(0.);\n    float totalWeight = 0.;\n    for(int dx=0; dx<2; dx++) for(int dy=0; dy<2; dy++) {\n      vec2 delta = .5*vec2(dx, dy);\n      vec2 center = delta+vec2(.5);\n      vec2 tc = fract(p-delta)+delta;\n      float dst = dot(abs(tc-center),vec2(1.));\n      float w = max(.5-dst,0.);\n      w=w*w;\n      color += w * texture2D(_sampler"+
a+", tc*_cropfact"+a+");\n      totalWeight += w;\n    }\n    return color/totalWeight;":b.repeat?"return texture2D(_sampler"+a+", p*_cropfact"+a+");":"if(0. <= p.x && p.x <= 1. && 0. <= p.y && p.y <= 1.)\n          return texture2D(_sampler"+a+", p*_cropfact"+a+");\n       else\n          return vec4(0.);")+"\n  }"}
function fc(a){var b=a.m,c=a.C,b={S:b.hasOwnProperty("interpolate")?c.evaluateAndVal(b.interpolate).value:!0,K:b.hasOwnProperty("mipmap")?c.evaluateAndVal(b.mipmap).value:!1,repeat:b.hasOwnProperty("repeat")?c.evaluateAndVal(b.repeat).value:!1};!a.j||a.j.K==b.K&&a.j.repeat==b.repeat||(console.log("enfore recompilation because texture modifiers changed."),pa++);a.j=b}
function Xa(a){var b=a.C.evaluateAndVal(a.X).value,c="string"===typeof b?a.C.getImage(b,!0):b;if(null==c)return console.error("Could not find image "+b+"."),r;fc(a);return Ha(c,a.j)}function gc(a,b,c){c.O.hasOwnProperty(a)||(c.O[a]=new ec(a,c.D[a].X,b,c.C));return a}function Vb(a,b,c){return["_imagergba",gc(a[2],b,c),"(",a[0],",",a[1],",",a[3],")"].join("")}function Tb(a,b,c){return["(_imagergba",gc(a[2],b,c),"(",a[0],",",a[1],",",a[3],").rgb)"].join("")}
function Ub(a,b,c){c.add("uniforms","corners",function(){return"uniform vec2 _lowerleft, _lowerright;"});return["_imagergba",gc(a[0],b,c),"(_lowerleft, _lowerright, ",a[1],")"].join("")}function Sb(a,b,c){c.add("uniforms","corners",function(){return"uniform vec2 _lowerleft, _lowerright;"});return["(_imagergba",gc(a[0],b,c),"(_lowerleft, _lowerright, ",a[1],").rgb)"].join("")};function hc(a){var b;b=b?b:null;return"list"!==a.ctype?(console.log("argument is not a list"),b):a.value}function Za(a){var b;b=b?b:[.5,.5,.5];if("number"===a.ctype){var c=ic(a);if(!isNaN(c))return[c,c,c]}a=hc(a);return a?3!=a.length?(console.log("Not an RGB color vector"),b):a.map(function(a){return ic(a)}):b}
function Ya(a){var b;b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;b=a.value;a=b.real;b=b.imag;0!==b&&console.log("complex number is not real");b=Math.round(a);b!==a&&console.log("number is not an integer");return b}
function ic(a){var b;b=void 0===b?Number.NaN:b;b=void 0===b?Number.NaN:b;"number"!==a.ctype?(console.log("argument is not a number"),a=b):(a=a.value,b=a.real,0!==a.imag&&console.log("complex number is not real"),a=b);return 0>a?0:1<a?1:a};function ra(a){this.j=a}ra.prototype.toString=function(){return this.j};
function La(a,b){var c=n;this.j=c.createProgram();c.j&&(a="#version 300 es\n"+a.replace(/attribute/g,"in").replace(/varying/g,"out"),b="#version 300 es\n"+b.replace(/varying/g,"in").replace(/gl_FragColor/g,"FragColor").replace(/texture2D/g,"texture").replace(/precision highp float;/g,"precision highp float;\n#define webgl2 true\nout vec4 FragColor;"));this.Z=jc(this,c,c.VERTEX_SHADER,a);jc(this,c,c.FRAGMENT_SHADER,b);a=this.j;c.linkProgram(a);if(!c.getProgramParameter(a,c.LINK_STATUS))throw new ra("Error linking shader:\n"+
c.getProgramInfoLog(a));c.validateProgram(a);if(!c.getProgramParameter(a,c.VALIDATE_STATUS))throw new ra("Error validating shader:\n"+c.getProgramInfoLog(a));var d=this.j,f,g,k,l={},p,q,t,u;b=c.getProgramParameter(d,c.ACTIVE_UNIFORMS);for(a=0;a<b;++a)if(f=c.getActiveUniform(d,a))if(g=f.name.replace(/\]/g,"")){for(p=l;k=/[.\[]/.exec(g);)q=g.substr(0,k.index),p.hasOwnProperty(q)?p=p[q]:"."===k[0]?p=p[q]={}:p=p[q]=[],g=g.substr(k.index+1);if(1<f.size){k=f.size;u=Array(k);for(q=0;q<k;++q)t=f.name+"["+
q+"]",t=kc(this,c,t,f),u[q]=t;p[g]=u}else t=kc(this,c,f.name,f),p[g]=t}this.m=l}function jc(a,b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))throw console.warn(d.split("\n")),new ra("Error compiling shader:\n"+b.getShaderInfoLog(c));b.attachShader(a.j,c);return c}
function kc(a,b,c,d){a=b.getUniformLocation(a.j,c);switch(d.type){case b.FLOAT:return b.uniform1fv.bind(b,a);case b.FLOAT_VEC2:return b.uniform2fv.bind(b,a);case b.FLOAT_VEC3:return b.uniform3fv.bind(b,a);case b.FLOAT_VEC4:return b.uniform4fv.bind(b,a);case b.BOOL:case b.INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:return b.uniform1iv.bind(b,a);case b.BOOL_VEC2:case b.INT_VEC2:return b.uniform2iv.bind(b,a);case b.BOOL_VEC3:case b.INT_VEC3:return b.uniform3iv.bind(b,a);case b.BOOL_VEC4:case b.INT_VEC4:return b.uniform4iv.bind(b,
a);case b.FLOAT_MAT2:return b.uniformMatrix2fv.bind(b,a,!1);case b.FLOAT_MAT3:return b.uniformMatrix3fv.bind(b,a,!1);case b.FLOAT_MAT4:return b.uniformMatrix4fv.bind(b,a,!1);default:throw new ra("Unknown data type for uniform "+c);}};
}).call(this);//# sourceMappingURL=CindyGL.js.map


