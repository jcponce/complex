(function(){
'use strict';var q,ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},r="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;function ca(){ca=function(){};r.Symbol||(r.Symbol=da)}var ea=0;function da(a){return"jscomp_symbol_"+(a||"")+ea++}
function t(){ca();var a=r.Symbol.iterator;a||(a=r.Symbol.iterator=r.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&ba(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return fa(this)}});t=function(){}}function fa(a){var b=0;return ga(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function ga(a){t();a={next:a};a[r.Symbol.iterator]=function(){return this};return a}function ha(a){t();var b=a[Symbol.iterator];return b?b.call(a):fa(a)}
function u(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function ia(a,b){if(b){var c=r;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ba(c,a,{configurable:!0,writable:!0,value:b})}}
ia("WeakMap",function(a){function b(a){this.f=(f+=Math.random()+1).toString();if(a){ca();t();a=ha(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}}function c(a){u(a,e)||ba(a,e,{value:{}})}function d(a){var b=Object[a];b&&(Object[a]=function(a){c(a);return b(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(e){return!1}}())return a;
var e="$jscomp_hidden_"+Math.random().toString().substring(2);d("freeze");d("preventExtensions");d("seal");var f=0;b.prototype.set=function(a,b){c(a);if(!u(a,e))throw Error("WeakMap key fail: "+a);a[e][this.f]=b;return this};b.prototype.get=function(a){return u(a,e)?a[e][this.f]:void 0};b.prototype.has=function(a){return u(a,e)&&u(a[e],this.f)};b.prototype.delete=function(a){return u(a,e)&&u(a[e],this.f)?delete a[e][this.f]:!1};return b});
ia("Map",function(a){function b(){var a={};return a.G=a.next=a.head=a}function c(a,b){var c=a.f;return ga(function(){if(c){for(;c.head!=a.f;)c=c.G;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})}function d(a,b){var c;c=b&&typeof b;"object"==c||"function"==c?f.has(b)?c=f.get(b):(c=""+ ++k,f.set(b,c)):c="p_"+b;var d=a.g[c];if(d&&u(a.g,c))for(a=0;a<d.length;a++){var e=d[a];if(b!==b&&e.key!==e.key||b===e.key)return{id:c,list:d,index:a,o:e}}return{id:c,list:d,
index:-1,o:void 0}}function e(a){this.g={};this.f=b();this.size=0;if(a){a=ha(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}}if(function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a(ha([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?
!1:!0}catch(f){return!1}}())return a;ca();t();var f=new WeakMap;e.prototype.set=function(a,b){var c=d(this,a);c.list||(c.list=this.g[c.id]=[]);c.o?c.o.value=b:(c.o={next:this.f,G:this.f.G,head:this.f,key:a,value:b},c.list.push(c.o),this.f.G.next=c.o,this.f.G=c.o,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.o&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.g[a.id],a.o.G.next=a.o.next,a.o.next.G=a.o.G,a.o.head=null,this.size--,!0):!1};e.prototype.clear=
function(){this.g={};this.f=this.f.G=b();this.size=0};e.prototype.has=function(a){return!!d(this,a).o};e.prototype.get=function(a){return(a=d(this,a).o)&&a.value};e.prototype.entries=function(){return c(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return c(this,function(a){return a.key})};e.prototype.values=function(){return c(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};
e.prototype[Symbol.iterator]=e.prototype.entries;var k=0;return e});ia("Math.hypot",function(a){return a?a:function(a,c,d){a=Number(a);c=Number(c);var e,f,k,h=Math.max(Math.abs(a),Math.abs(c));for(e=2;e<arguments.length;e++)h=Math.max(h,Math.abs(arguments[e]));if(1E100<h||1E-100>h){a/=h;c/=h;k=a*a+c*c;for(e=2;e<arguments.length;e++)f=Number(arguments[e])/h,k+=f*f;return Math.sqrt(k)*h}k=a*a+c*c;for(e=2;e<arguments.length;e++)f=Number(arguments[e]),k+=f*f;return Math.sqrt(k)}});function v(a){this.f=a}v.prototype.toString=function(){return this.f};
function ja(a,b,c){this.f=a.createProgram();a.f&&(b="#version 300 es\n"+b.replace(/attribute/g,"in").replace(/varying/g,"out"),c="#version 300 es\n"+c.replace(/varying/g,"in").replace(/gl_FragColor/g,"FragColor").replace(/texture2D/g,"texture").replace(/precision highp float;/g,"precision highp float;\n#define webgl2 true\nout vec4 FragColor;"));this.i=ka(this,a,a.VERTEX_SHADER,b);this.g=ka(this,a,a.FRAGMENT_SHADER,c);b=this.f;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS))throw new v("Error linking shader:\n"+
a.getProgramInfoLog(b));a.validateProgram(b);if(!a.getProgramParameter(b,a.VALIDATE_STATUS))throw new v("Error validating shader:\n"+a.getProgramInfoLog(b));var d=this.f,e,f,k,h={},l,g,n,m;c=a.getProgramParameter(d,a.ACTIVE_UNIFORMS);for(b=0;b<c;++b)if(e=a.getActiveUniform(d,b))if(f=e.name.replace(/\]/g,"")){for(l=h;k=/[.\[]/.exec(f);)g=f.substr(0,k.index),l.hasOwnProperty(g)?l=l[g]:"."===k[0]?l=l[g]={}:l=l[g]=[],f=f.substr(k.index+1);if(1<e.size){k=e.size;m=Array(k);for(g=0;g<k;++g)n=e.name+"["+
g+"]",n=la(this,a,n,e),m[g]=n;l[f]=m}else n=la(this,a,e.name,e),l[f]=n}this.h=h}function ka(a,b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))throw console.warn(d.split("\n")),new v("Error compiling shader:\n"+b.getShaderInfoLog(c));b.attachShader(a.f,c);return c}function ma(a,b){b.detachShader(a.f,a.i);b.deleteShader(a.i);b.detachShader(a.f,a.g);b.deleteShader(a.g);b.deleteProgram(a.f)}
function la(a,b,c,d){a=b.getUniformLocation(a.f,c);switch(d.type){case b.FLOAT:return b.uniform1fv.bind(b,a);case b.FLOAT_VEC2:return b.uniform2fv.bind(b,a);case b.FLOAT_VEC3:return b.uniform3fv.bind(b,a);case b.FLOAT_VEC4:return b.uniform4fv.bind(b,a);case b.BOOL:case b.INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:return b.uniform1iv.bind(b,a);case b.BOOL_VEC2:case b.INT_VEC2:return b.uniform2iv.bind(b,a);case b.BOOL_VEC3:case b.INT_VEC3:return b.uniform3iv.bind(b,a);case b.BOOL_VEC4:case b.INT_VEC4:return b.uniform4iv.bind(b,
a);case b.FLOAT_MAT2:return b.uniformMatrix2fv.bind(b,a,!1);case b.FLOAT_MAT3:return b.uniformMatrix3fv.bind(b,a,!1);case b.FLOAT_MAT4:return b.uniformMatrix4fv.bind(b,a,!1);default:throw new v("Unknown data type for uniform "+c);}};function na(a){var b=a[0],c=a[1];a=a[2];var d=1/Math.sqrt(b*b+c*c+a*a);return[d*b,d*c,d*a]}function x(a){var b=1/a[3];return[b*a[0],b*a[1],b*a[2]]}function oa(a,b){return[a*b[0],a*b[1],a*b[2]]}function y(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]}function pa(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function qa(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3]]}function z(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}
function B(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+
a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]}function ra(a,b,c){a=x(a);return na(z(y(x(b),a),y(x(c),a)))};function sa(a,b){this.width=a;this.height=b;this.ga=Math.PI/360*45;this.X=.1;this.W=100;ta(this);Ba(this,[0,0,5],[0,0,0],[0,1,0])}function ta(a){var b=1/Math.tan(a.ga),c=a.X-a.W;a.l=[b*a.height/a.width,0,0,0,0,b,0,0,0,0,(a.W+a.X)/c,-1,0,0,2*a.W*a.X/c,0]}
function Ba(a,b,c,d){b=y(b,c);var e=b[0],f=b[1],k=b[2];a.h=Math.sqrt(e*e+f*f+k*k);b=na(b);d=na(z(d,b));e=z(b,d);d=[d[0],e[0],b[0],d[1],e[1],b[1],d[2],e[2],b[2]];d=[d[4]*d[8]-d[5]*d[7],d[2]*d[7]-d[1]*d[8],d[1]*d[5]-d[2]*d[4],d[5]*d[6]-d[3]*d[8],d[0]*d[8]-d[2]*d[6],d[2]*d[3]-d[0]*d[5],d[3]*d[7]-d[4]*d[6],d[1]*d[6]-d[0]*d[7],d[0]*d[4]-d[1]*d[3]];c=[d[0]*c[0]+d[1]*c[1]+d[2]*c[2],d[3]*c[0]+d[4]*c[1]+d[5]*c[2],d[6]*c[0]+d[7]*c[1]+d[8]*c[2]];a.f=[d[0],d[1],d[2],-c[0],d[3],d[4],d[5],-c[1],d[6],d[7],d[8],
-c[2],0,0,0,1];a.i=[1,0,0,0,0,1,0,0,0,0,1,-a.h,0,0,0,1];a.g=B(a.i,a.f)}function Ca(a,b,c){var d=.01*b,e=.01*c;c=Math.cos(d);b=Math.cos(e);d=Math.sin(d);e=Math.sin(e);a.f=B(B([c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1],[1,0,0,0,0,b,-e,0,0,e,b,0,0,0,0,1]),a.f);a.g=B(a.i,a.f)}function Da(a,b,c){var d=.002*a.h;a.f=B([1,0,0,d*b,0,1,0,-d*c,0,0,1,0,0,0,0,1],a.f);a.g=B(a.i,a.f)}function Ea(a,b){a.h*=Math.pow(1.01,b);a.i=[1,0,0,0,0,1,0,0,0,0,1,-a.h,0,0,0,1];a.g=B(a.i,a.f)}
function Fa(a,b){var c=Math.cos(b);b=Math.sin(b);a.f=B([c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1],a.f);a.g=B(a.i,a.f)};function Ga(a){return{color:a,alpha:1,s:60,size:.05}}function C(a){return{color:a.color,alpha:a.alpha,s:a.s,size:a.size}};function Ha(a,b,c,d){function e(a){f.removeEventListener("webglcontextcreationerror",e,!1);a.statusMessage&&(k=a.statusMessage)}var f=document.getElementById(a);if(!f)throw new v("No canvas element with id "+a);var k="Unknown";f.addEventListener("webglcontextcreationerror",e,!1);(a=f.getContext("webgl",b))||(a=f.getContext("experimental-webgl",b));if(!a)throw new v("Could not obtain a WebGL context.\nReason: "+k);/[?&]frag_depth=0/.test(window.location.search)?this.u=null:(this.u=a.getExtension("EXT_frag_depth"),
this.u||(console.log("EXT_frag_depth extension not supported, will try webgl 2.0."),(b=f.getContext("webgl2",b))?(a=b,a.f=!0,console.log("Loaded Webgl 2.0!")):console.log("Webgl 2.0 is not availible, render in reduced quality.")));f.removeEventListener("webglcontextcreationerror",e,!1);a.depthFunc(a.LEQUAL);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);this.S=f;this.width=f.width;this.height=f.height;this.f=a;this.g=1;c&&c.ja&&(this.g=c.ja|0,1>this.g&&(this.g=1));if(1!==this.g){c=this.width*this.height*
this.g;for(b=64;b*b<c;)b*=2;this.l=this.i=b;this.H=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.H);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.hint(a.GENERATE_MIPMAP_HINT,a.NICEST);a.texImage2D(a.TEXTURE_2D,0,a.RGB,this.l,this.i,0,a.RGB,a.UNSIGNED_BYTE,null);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null);this.R=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.R);a.renderbufferStorage(a.RENDERBUFFER,
a.DEPTH_COMPONENT16,this.l,this.i);a.bindRenderbuffer(a.RENDERBUFFER,null);this.P=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.P);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.H,0);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.R);c=a.checkFramebufferStatus(a.FRAMEBUFFER);if(c!==a.FRAMEBUFFER_COMPLETE)throw new v("Failed to create supersampling framebuffer. glCheckFramebufferStatus returned "+c);a.bindFramebuffer(a.FRAMEBUFFER,
null);this.O=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.O);a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,1,1,-1,1,0,1,1,-1,1,0,-1,-1,0,0]),a.STATIC_DRAW);this.J=new ja(a,"precision highp float;\n\nattribute vec4 aPos;\nvarying vec2 vPos;\n\nvoid main(){\nvPos=aPos.zw;\ngl_Position=vec4(aPos.xy,0,1);\n}\n","precision highp float;\n\nuniform sampler2D uTexture;\nvarying vec2 vPos;\n\nvoid main(){\ngl_FragColor=texture2D(uTexture,vPos);\n}\n");this.I=a.getAttribLocation(this.J.f,"aPos")}else this.l=
this.width,this.i=this.height;this.F=new Ia;this.M="uniform vec3 uAmbient;\nuniform mat4 uModelViewMatrix;\n\nvarying vec4 vColor;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;\n\nvec4 gColor;\nvec3 gPos;\nvec3 gEye;\nvec3 gNormal;\nvec3 gAccumDiffuse;\nvec3 gAccumSpecular;\n\nvoid commonLight(in vec4 lightPos,out vec3 lightDir,\nout float diffuseFactor,out float specularFactor){\nvec3 halfVector;\nfloat specularDot;\n\nlightDir=normalize(lightPos.xyz-lightPos.w*gPos);\nhalfVector=normalize(lightDir+gEye);\ndiffuseFactor=max(0.0,dot(gNormal,lightDir));\nspecularDot=max(0.0,dot(gNormal,halfVector));\n\n\nif(diffuseFactor==0.0)\nspecularFactor=0.0;\nelse\nspecularFactor=pow(specularDot,vShininess) *vSpecularReflectiveness;\n}\n\nvec4 flipY(in vec4 v){\nreturn vec4(v.x, -v.y,v.z,v.w);\n}\n\nvoid pointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\n\ngAccumDiffuse +=diffuse*diffuseFactor;\ngAccumSpecular+=specular*specularFactor;\n}\n\nvoid cameraPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(flipY(lightPos),diffuse,specular);\n}\n\nvoid worldPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(-uModelViewMatrix*lightPos,diffuse,specular);\n}\n\nvoid spotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\nvec3 spotDir;\nfloat spotCosAngle;\nfloat spotAttenuation;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\nspotDir=lightPos.w*spotPos.xyz-spotPos.w*lightPos.xyz;\nspotCosAngle=dot(-lightDir,normalize(spotDir));\nspotAttenuation=\nstep(spotCosCutoff,spotCosAngle) *pow(spotCosAngle,spotExponent);\n\n\ngAccumDiffuse +=spotAttenuation*diffuse*diffuseFactor;\ngAccumSpecular+=spotAttenuation*specular*specularFactor;\n}\n\nvoid cameraSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\nflipY(lightPos),flipY(spotPos),\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n\nvoid worldSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\n-uModelViewMatrix*lightPos, -uModelViewMatrix*spotPos,\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n"+
Ja(this.F)+"\n\n\n\n\n\nvoid shade(in vec3 position,in vec3 normal){\n\ngAccumDiffuse=vec3(0.0);\ngAccumSpecular=vec3(0.0);\n\n\ngPos=position;\ngEye= -normalize(position);\ngNormal=sign(dot(gEye,normal))*normal;\n\n\nlightScene();\n\n\n\nvec3 color= (uAmbient+gAccumDiffuse) *gColor.xyz\n+gAccumSpecular;\n\ncolor=clamp(color,0.0,1.0);\ngl_FragColor=vec4(color.xyz,gColor.w);\n}\n";this.j=new sa(this.width,this.height);this.L=new E(this);this.K=new G(this);this.w=new Ka(this);this.D=C(H.U);this.A=C(H.T);
this.v=C(H.V);this.fa=[];this.backgroundColor=[1,1,1,1];d||(d=function(a,b,c,d){a.addEventListener(b,c,!!d)});new La(d,this.S,this.j,this)}var H={U:C(Ga([1,0,0])),T:C(Ga([0,0,1])),V:C(Ga([0,1,0]))};Ha.prototype.clear=function(){this.L.clear();this.K.clear();this.w.clear()};
Ha.prototype.B=function(){this.F.g&&(this.M="uniform vec3 uAmbient;\nuniform mat4 uModelViewMatrix;\n\nvarying vec4 vColor;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;\n\nvec4 gColor;\nvec3 gPos;\nvec3 gEye;\nvec3 gNormal;\nvec3 gAccumDiffuse;\nvec3 gAccumSpecular;\n\nvoid commonLight(in vec4 lightPos,out vec3 lightDir,\nout float diffuseFactor,out float specularFactor){\nvec3 halfVector;\nfloat specularDot;\n\nlightDir=normalize(lightPos.xyz-lightPos.w*gPos);\nhalfVector=normalize(lightDir+gEye);\ndiffuseFactor=max(0.0,dot(gNormal,lightDir));\nspecularDot=max(0.0,dot(gNormal,halfVector));\n\n\nif(diffuseFactor==0.0)\nspecularFactor=0.0;\nelse\nspecularFactor=pow(specularDot,vShininess) *vSpecularReflectiveness;\n}\n\nvec4 flipY(in vec4 v){\nreturn vec4(v.x, -v.y,v.z,v.w);\n}\n\nvoid pointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\n\ngAccumDiffuse +=diffuse*diffuseFactor;\ngAccumSpecular+=specular*specularFactor;\n}\n\nvoid cameraPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(flipY(lightPos),diffuse,specular);\n}\n\nvoid worldPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(-uModelViewMatrix*lightPos,diffuse,specular);\n}\n\nvoid spotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\nvec3 spotDir;\nfloat spotCosAngle;\nfloat spotAttenuation;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\nspotDir=lightPos.w*spotPos.xyz-spotPos.w*lightPos.xyz;\nspotCosAngle=dot(-lightDir,normalize(spotDir));\nspotAttenuation=\nstep(spotCosCutoff,spotCosAngle) *pow(spotCosAngle,spotExponent);\n\n\ngAccumDiffuse +=spotAttenuation*diffuse*diffuseFactor;\ngAccumSpecular+=spotAttenuation*specular*specularFactor;\n}\n\nvoid cameraSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\nflipY(lightPos),flipY(spotPos),\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n\nvoid worldSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\n-uModelViewMatrix*lightPos, -uModelViewMatrix*spotPos,\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n"+Ja(this.F)+
"\n\n\n\n\n\nvoid shade(in vec3 position,in vec3 normal){\n\ngAccumDiffuse=vec3(0.0);\ngAccumSpecular=vec3(0.0);\n\n\ngPos=position;\ngEye= -normalize(position);\ngNormal=sign(dot(gEye,normal))*normal;\n\n\nlightScene();\n\n\n\nvec3 color= (uAmbient+gAccumDiffuse) *gColor.xyz\n+gAccumSpecular;\n\ncolor=clamp(color,0.0,1.0);\ngl_FragColor=vec4(color.xyz,gColor.w);\n}\n",Ma(this.L,this),Ma(this.K,this),Ma(this.w,this));if(1===this.g)Na(this);else{var a=this.f;a.bindFramebuffer(a.FRAMEBUFFER,this.P);
Na(this);a.bindFramebuffer(a.FRAMEBUFFER,null);a.viewport(0,0,this.width,this.height);a.disable(a.DEPTH_TEST);a.bindTexture(a.TEXTURE_2D,this.H);a.generateMipmap(a.TEXTURE_2D);a.bindBuffer(a.ARRAY_BUFFER,this.O);a.enableVertexAttribArray(this.I);a.vertexAttribPointer(this.I,4,a.FLOAT,!1,16,0);a.useProgram(this.J.f);this.J.h.uTexture([0]);a.drawArrays(a.TRIANGLE_STRIP,0,4);a.disableVertexAttribArray(this.I);a.bindTexture(a.TEXTURE_2D,null)}this.f.flush()};
function Na(a){var b=a.f;b.viewport(0,0,a.l,a.i);b.clearColor.apply(b,a.backgroundColor);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);a.L.C&&a.K.C&&a.w.C?(b.disable(b.BLEND),b.depthMask(!0),b.enable(b.DEPTH_TEST),Oa(a,!0)):(b.disable(b.DEPTH_TEST),b.enable(b.BLEND),b.depthMask(!1),Oa(a,!1),Oa(a,!1),b.depthMask(!0),b.enable(b.DEPTH_TEST),Oa(a,!1))}function Oa(a,b){b||a.L.B(a,1);a.w.B(a);a.K.B(a);a.L.B(a,-1)}
Ha.prototype.h=function(a){a.uProjectionMatrix(this.j.l);var b=this.j.g;a.uModelViewMatrix([b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]]);b=this.F;a.uAmbient(b.ea);for(var c=0;c<b.f.length;++c)b.f[c]&&Pa(b.f[c],a,c)};function La(a,b,c,d){this.u=b;this.j=c;this.l=d;this.i=this.h=Number.NaN;this.g=!1;this.f=new Map;a(b,"mousedown",this.pa.bind(this));a(b,"mousemove",this.ra.bind(this));a(b,"mouseup",this.sa.bind(this));a(b,"mouseleave",this.qa.bind(this));a(b,"wheel",this.xa.bind(this));a(b,"touchstart",this.wa.bind(this));a(b,"touchend",this.ua.bind(this));a(b,"touchcancel",this.ta.bind(this));a(b,"touchmove",this.va.bind(this))}q=La.prototype;
q.pa=function(a){a.button||(this.g=!0);if(void 0===a.buttons?this.g:a.buttons&1)this.h=a.clientX,this.i=a.clientY};
q.ra=function(a){if(void 0===a.buttons?this.g:a.buttons&1){if(!isNaN(this.h)){var b=a.clientX-this.h,c=a.clientY-this.i;if(a.shiftKey){var d=this.j,e=-.01*b,f=-.01*c,c=Math.cos(e),b=Math.cos(f),e=Math.sin(e),f=Math.sin(f),k=[1,0,0,0,0,1,0,0,0,0,1,d.h,0,0,0,1];d.g=B(B([c,0,e,0,0,1,0,0,-e,0,c,0,0,0,0,1],[1,0,0,0,0,b,-f,0,0,f,b,0,0,0,0,1]),d.g);d.f=B(k,d.g)}else a.altKey||a.ctrlKey||a.metaKey?Da(this.j,b,c):Ca(this.j,b,c);this.l.B()}this.h=a.clientX;this.i=a.clientY}};
q.sa=function(a){a.button||(this.g=!1)};q.qa=function(){this.g=!1;this.h=this.i=Number.NaN};q.xa=function(a){var b=a.deltaY;if(b){if(a.shiftKey)Fa(this.j,-.01*b);else if(a.altKey||a.ctrlKey||a.metaKey){var c=this.j;c.f=B([1,0,0,0,0,1,0,0,0,0,1,-.02*c.h*b,0,0,0,1],c.f);c.g=B(c.i,c.f)}else Ea(this.j,b);this.l.B()}a.preventDefault()};q.wa=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b){var c=a[b];this.f.set(c.identifier,{x:c.clientX,y:c.clientY})}};
q.ua=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b)this.f.delete(a[b].identifier)};q.ta=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b)this.f.delete(a[b].identifier)};
q.va=function(a){a.preventDefault();var b=a.targetTouches;if(1===b.length){var c=b[0],b=this.f.get(c.identifier);Ca(this.j,c.clientX-b.x,c.clientY-b.y);this.l.B()}else if(2===b.length){var c=b[0],d=b[1],e=this.f.get(c.identifier),f=this.f.get(d.identifier),k=this.u.getBoundingClientRect(),b=this.u.clientLeft+k.left+.5*this.j.width,k=this.u.clientTop+k.top+.5*this.j.height,h=.5*(e.x+f.x+1),l=.5*(e.y+f.y+1);Da(this.j,b-h,k-l);var g=e.x-f.x,e=e.y-f.y,f=Math.hypot(g,e),n=Math.atan2(e,g),h=.5*(c.clientX+
d.clientX+1),l=.5*(c.clientY+d.clientY+1),g=c.clientX-d.clientX,e=c.clientY-d.clientY,c=Math.atan2(e,g);Ea(this.j,f-Math.hypot(g,e));Fa(this.j,n-c);Da(this.j,h-b,l-k);this.l.B()}b=a.changedTouches;for(a=0;a<b.length;++a)c=b[a],d=this.f.get(c.identifier),d.x=c.clientX,d.y=c.clientY};function Ia(){this.ea=[0,0,0];this.f=[new Qa([0,0,0,1],[1,1,1],[1,1,1])];this.g=!1}function Ra(a,b,c){a.g=!c!==!a.f[b]||!!c&&a.f[b].f!==c.f;a.f[b]=c}function Ja(a){for(var b="",c="",d=0;d<a.f.length;++d)a.f[d]&&(b+=Sa(a.f[d],d),c+=Ta(a.f[d],d));return b+"void lightScene() {\n"+c+"}"}function I(a,b){this.f=a;this.g=b}I.prototype.h={uDiffuse:"vec3",uSpecular:"vec3",uLightPos:"vec4",uSpotPos:"vec4",uSpotCosCutoff:"float",uSpotExponent:"float"};
function Ta(a,b){return"  "+a.f+"("+a.g.map(function(a){return a+b}).join(", ")+");\n"}function Sa(a,b){return a.g.map(function(c){return"uniform "+a.h[c]+" "+c+b+";\n"}).join("")}function Pa(a,b,c){a.g.forEach(function(d){return b[d+c](a[d])})}function Qa(a,b,c){this.uLightPos=a;this.uDiffuse=b;this.uSpecular=c}Qa.prototype=new I("cameraPointLight",["uLightPos","uDiffuse","uSpecular"]);function Ua(a,b,c){this.uLightPos=a;this.uDiffuse=b;this.uSpecular=c}
Ua.prototype=new I("worldPointLight",["uLightPos","uDiffuse","uSpecular"]);var Va={camera:Qa,world:Ua};function Wa(a,b,c,d,e,f){this.uLightPos=a;this.uSpotPos=b;this.uSpotCosCutoff=[c];this.uSpotExponent=[d];this.uDiffuse=e;this.uSpecular=f}Wa.prototype=new I("cameraSpotLight","uLightPos uSpotPos uSpotCosCutoff uSpotExponent uDiffuse uSpecular".split(" "));function $a(a,b,c,d,e,f){this.uLightPos=a;this.uSpotPos=b;this.uSpotCosCutoff=[c];this.uSpotExponent=[d];this.uDiffuse=e;this.uSpecular=f}
$a.prototype=new I("worldSpotLight","uLightPos uSpotPos uSpotCosCutoff uSpotExponent uDiffuse uSpecular".split(" "));var ab={camera:Wa,world:$a};function L(a,b){var c=a.length,d=b.length,e=Math.max.apply(null,b)+1;this.ka=a;this.aa=c;this.ca=e;this.R=b;this.ba=d;this.l=4*e*c;this.da=16*c;this.i=a=e*this.da;this.O=a+d*this.J;this.M=Math.floor(65536/a)}L.prototype.J=2;
function bb(a,b,c){a.la=b;a.f=0;a.C=!0;a.g=16;a.H=new ArrayBuffer(16*a.O);a.I=new Float32Array(a.H,0,16*a.l);b=new Uint16Array(a.H,16*a.i);a.h=b;var d,e,f=0,k,h=a.R;for(d=0;16>d;++d)for(k=d*a.ca,e=0;e<h.length;++e)b[f++]=h[e]+k;a.ma=c.f.createBuffer();a.na=c.f.createBuffer();a.S=-1;a.u=null;Ma(a,c)}
function Ma(a,b){var c=b.f;a.u&&ma(a.u,c);var d=["precision highp float;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;",a.$].join("\n"),e=["precision highp float;",b.M,a.Y].join("\n");b.u&&(e="#extension GL_EXT_frag_depth : enable\n"+e);a.u=new ja(c,d,e);var f=a.u.f;a.P=a.ka.map(function(a){return c.getAttribLocation(f,a)})}
function cb(a,b){if(b.length!==a.l)throw new v("Wrong number of attributes given");if(a.f==a.g){var c=2*a.g,d,e,f,k,h,l,g,n=a.R;c>a.M&&(a.g<a.M?c=a.M:(a.J=4,a.O=a.i+a.ba*a.J,a.M=Math.floor(Math.pow(2,32)/a.i)));d=new ArrayBuffer(c*a.O);e=new Float32Array(d,0,c*a.l);2===a.J?f=new Uint16Array(d,c*a.i):f=new Uint32Array(d,c*a.i);e.set(a.I);f.set(a.h);l=a.h.length;for(k=a.g;k<c;++k)for(g=k*a.ca,h=0;h<n.length;++h)f[l++]=n[h]+g;a.g=c;a.H=d;a.I=e;a.h=f}a.I.set(b,a.f++*a.l)}
function db(a,b,c){if(a.f){var d=a.u,e=d.h;b.useProgram(d.f);c(e);b.bindBuffer(b.ARRAY_BUFFER,a.ma);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.na);a.S!==a.g?(b.bufferData(b.ARRAY_BUFFER,a.I,b.STATIC_DRAW),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.h,b.STATIC_DRAW),a.S=a.g):b.bufferSubData(b.ARRAY_BUFFER,0,new Float32Array(a.H,0,a.f*a.l));for(c=0;c<a.aa;++c)d=a.P[c],b.enableVertexAttribArray(d),b.vertexAttribPointer(d,4,b.FLOAT,!1,a.da,16*c);c=b.UNSIGNED_SHORT;a.h instanceof Uint32Array&&(c=b.UNSIGNED_INT,b.getExtension("OES_element_index_uint"));
b.drawElements(a.la,a.ba*a.f,c,0);for(c=0;c<a.aa;++c)b.disableVertexAttribArray(a.P[c])}}L.prototype.clear=function(){this.f=0;this.C=!0};function E(a){bb(this,a.f.TRIANGLES,a)}E.prototype=new L(["aCenter","aColor","aRelativeShininessRadius"],[0,1,2,2,1,3]);E.prototype.$="uniform mat4 uProjectionMatrix;\n\nuniform mat4 uModelViewMatrix;\n\nattribute vec4 aCenter;\n\nattribute vec4 aColor;\n\nattribute vec4 aRelativeShininessRadius;\n\nvarying vec3 vViewSpacePos;\n\nvarying vec3 vViewSpaceCenter;\n\nvarying vec4 vColor;\n\nvarying float vRadius;\n\n\n\n\nvoid main(){\n\nvec4 viewPosHom=uModelViewMatrix*aCenter;\nvViewSpaceCenter=viewPosHom.xyz/viewPosHom.w;\nvec3 dir=normalize(-vViewSpaceCenter);\nvec3 right=normalize(cross(dir,vec3(0,1,0)));\nvec3 up=normalize(cross(right,dir));\n\n\nvColor=aColor;\nvShininess=aRelativeShininessRadius.z;\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\nvRadius=aRelativeShininessRadius.w;\n\n\nvViewSpacePos=vViewSpaceCenter+\nvRadius*(right*aRelativeShininessRadius.x+\nup*aRelativeShininessRadius.y+dir);\n\n\ngl_Position=uProjectionMatrix*vec4(vViewSpacePos,1);\n}\n";
E.prototype.Y="uniform mat4 uProjectionMatrix;\n\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\n\nvec3 dir=normalize(ray);\n\n\n\n\nfloat b=dot(center,dir);\nfloat c=dot(center,center) -radius*radius;\nfloat d=b*b-c;\nif(d<0.0)discard;\nfloat lambda=b+face*sqrt(d);\nif(lambda<0.0)discard;\n\n\nreturn lambda*dir;\n}\n\nvoid finish(in vec3 pos,in vec3 normal){\nshade(pos,normal);\n#ifdef GL_EXT_frag_depth\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n#ifdef webgl2\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n}\n\n\nuniform float sphereMode;\n\n\nvarying vec3 vViewSpacePos;\n\nvarying vec3 vViewSpaceCenter;\n\nvarying float vRadius;\n\n\n\n\nvoid main(){\ngColor=vColor;\nvec3 pointOnSphere=\nsphere(vViewSpacePos,vViewSpaceCenter,vRadius,sphereMode);\nvec3 normal=normalize(pointOnSphere-vViewSpaceCenter);\nfinish(pointOnSphere,normal);\n}\n";
E.prototype.add=function(a,b,c){var d=a[0],e=a[1],f=a[2];a=a[3];var k=c.color,h=c.s,l=k[0],g=k[1],k=k[2];c=c.alpha;1>c&&(this.C=!1);cb(this,[d,e,f,a,l,g,k,c,1,1,h,b,d,e,f,a,l,g,k,c,-1,1,h,b,d,e,f,a,l,g,k,c,1,-1,h,b,d,e,f,a,l,g,k,c,-1,-1,h,b])};E.prototype.B=function(a,b){db(this,a.f,function(c){a.h(c);c.sphereMode([b])})};function G(a){bb(this,a.f.TRIANGLE_STRIP,a)}G.prototype=new L(["aPoint1","aPoint2","aColor","aRelativeRadius","aShininess"],[0,0,2,4,6,7,2,3,1,7,5,4,1,0,2,2]);G.prototype.$="uniform mat4 uProjectionMatrix;\n\nuniform mat4 uModelViewMatrix;\n\nattribute vec4 aPoint1;\n\nattribute vec4 aPoint2;\n\nattribute vec4 aColor;\n\nattribute vec4 aRelativeRadius;\n\nattribute vec4 aShininess;\n\nvarying vec3 vPoint1;\n\nvarying vec3 vPoint2;\n\nvarying vec3 vPos;\n\nvarying vec4 vColor;\n\nvarying float vRadius;\n\n\n\n\nvoid main(){\n\nvec4 hom;\nhom=uModelViewMatrix*aPoint1;\nvPoint1=hom.xyz/hom.w;\nhom=uModelViewMatrix*aPoint2;\nvPoint2=hom.xyz/hom.w;\nvec3 dir=normalize(vPoint2-vPoint1);\n\n\nvec3 d2,d3;\nif(abs(dir.x) <abs(dir.y))\nd2=vec3(1,0,0);\nelse\nd2=vec3(0,1,0);\nd2=normalize(cross(dir,d2));\nd3=normalize(cross(dir,d2));\n\nvPos=aRelativeRadius.w*(mat3(dir,d2,d3)*aRelativeRadius.xyz)\n+0.5*((vPoint2+vPoint1) +aRelativeRadius.x*(vPoint2-vPoint1));\n\n\nvColor=aColor;\nvShininess=aShininess.x;\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\nvRadius=aRelativeRadius.w;\n\n\ngl_Position=uProjectionMatrix*vec4(vPos,1);\n}\n";
G.prototype.Y="uniform mat4 uProjectionMatrix;\n\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\n\nvec3 dir=normalize(ray);\n\n\n\n\nfloat b=dot(center,dir);\nfloat c=dot(center,center) -radius*radius;\nfloat d=b*b-c;\nif(d<0.0)discard;\nfloat lambda=b+face*sqrt(d);\nif(lambda<0.0)discard;\n\n\nreturn lambda*dir;\n}\n\nvoid finish(in vec3 pos,in vec3 normal){\nshade(pos,normal);\n#ifdef GL_EXT_frag_depth\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n#ifdef webgl2\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n}\n\nvarying vec3 vPoint1;\n\nvarying vec3 vPoint2;\n\nvarying vec3 vPos;\n\nvarying float vRadius;\n\nvec3 endcaps(in float mu,inout vec3 pos){\nvec3 center;\nif(mu<0.0){\ncenter=vPoint1;\n}else if(mu>1.0){\ncenter=vPoint2;\n}else{\nreturn(1.0-mu)*vPoint1+mu*vPoint2;\n}\npos=sphere(vPos,center,vRadius, -1.0);\nreturn center;\n}\n\n\n\n\nvoid main(){\ngColor=vColor;\n\n\n\nvec3 ba=vPoint2-vPoint1;\nvec3 u=ba/dot(ba,ba);\nvec3 v=vPos-dot(vPos,ba)*u;\nvec3 w=dot(vPoint1,ba)*u-vPoint1;\nfloat a=dot(v,v);\nfloat b=2.0*dot(v,w);\nfloat c=dot(w,w) -vRadius*vRadius;\nfloat d=b*b-4.0*a*c;\nif(d<0.0)\ndiscard;\nfloat lambda= (b+sqrt(d))/(-2.0*a);\nvec3 pointOnSurface=lambda*vPos;\nfloat mu=dot(pointOnSurface-vPoint1,u);\nvec3 center=endcaps(mu,pointOnSurface);\nvec3 normal=normalize(pointOnSurface-center);\nfinish(pointOnSurface,normal);\n}\n";
G.prototype.add=function(a,b,c){var d=a[0],e=a[1],f=a[2];a=a[3];var k=b[0],h=b[1],l=b[2];b=b[3];var g=c.color,n=c.s,m=c.size,p=g[0],D=g[1],g=g[2];c=c.alpha;1>c&&(this.C=!1);cb(this,[d,e,f,a,k,h,l,b,p,D,g,c,1,1,1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,1,1,-1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,1,-1,1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,1,-1,-1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,-1,1,1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,-1,1,-1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,-1,-1,1,m,n,0,0,0,d,e,f,a,k,h,l,b,p,D,g,c,-1,-1,
-1,m,n,0,0,0])};G.prototype.B=function(a){if(this.f){var b=a.f;b.enable(b.CULL_FACE);b.cullFace(b.BACK);db(this,b,a.h.bind(a));b.disable(b.CULL_FACE)}};function Ka(a){bb(this,a.f.TRIANGLES,a)}Ka.prototype=new L(["aPos","aNormalAndShininess","aColor"],[0,1,2]);q=Ka.prototype;q.$="uniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nattribute vec4 aPos;\nattribute vec4 aNormalAndShininess;\nattribute vec4 aColor;\n\nvarying vec4 vPos;\nvarying vec4 vNormal;\nvarying vec4 vColor;\n\nvoid main(){\nvPos=uModelViewMatrix*aPos;\ngl_Position=uProjectionMatrix*vPos;\nvNormal=uModelViewMatrix*vec4(aNormalAndShininess.xyz,0.0);\nvShininess=aNormalAndShininess.w;\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\nvColor=aColor;\n}\n";
q.Y="uniform mat4 uProjectionMatrix;\n\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\n\nvec3 dir=normalize(ray);\n\n\n\n\nfloat b=dot(center,dir);\nfloat c=dot(center,center) -radius*radius;\nfloat d=b*b-c;\nif(d<0.0)discard;\nfloat lambda=b+face*sqrt(d);\nif(lambda<0.0)discard;\n\n\nreturn lambda*dir;\n}\n\nvoid finish(in vec3 pos,in vec3 normal){\nshade(pos,normal);\n#ifdef GL_EXT_frag_depth\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n#ifdef webgl2\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n}\n\nvarying vec4 vPos;\nvarying vec4 vNormal;\n\nuniform bool uTextured;\nuniform sampler2D uTexture;\n\nvoid main(){\nif(uTextured)\ngColor=texture2DProj(uTexture,vColor.xyz);\nelse\ngColor=vColor;\nfinish(vPos.xyz/vPos.w,normalize(vNormal.xyz));\n}\n";
function M(a,b,c,d,e,f,k,h){var l=h.color,g=h.s,n=l[0],m=l[1],l=l[2];h=h.alpha;1>h&&(a.C=!1);cb(a,[b[0],b[1],b[2],b[3],e[0],e[1],e[2],g,n,m,l,h,c[0],c[1],c[2],c[3],f[0],f[1],f[2],g,n,m,l,h,d[0],d[1],d[2],d[3],k[0],k[1],k[2],g,n,m,l,h])}function eb(a,b,c,d,e,f,k,h,l,g,n){var m=n.s;n=n.alpha;1>n&&(a.C=!1);cb(a,[b[0],b[1],b[2],b[3],e[0],e[1],e[2],m,h[0],h[1],h[2],n,c[0],c[1],c[2],c[3],f[0],f[1],f[2],m,l[0],l[1],l[2],n,d[0],d[1],d[2],d[3],k[0],k[1],k[2],m,g[0],g[1],g[2],n])}
function fb(a,b,c){if(3==b.length){var d=b[0],e=b[1];b=b[2];var f=ra(d,e,b);M(a,d,e,b,f,f,f,c)}else{for(var d=b.length,k=Array(d+2),f=[0,0,0],e=0;e<d;++e)k[e]=x(b[e]);k[d]=k[0];k[d+1]=k[1];for(e=1;e<=d;++e)f=pa(f,z(y(k[e],k[e-1]),y(k[e],k[e+1])));if(4==d)M(a,b[0],b[1],b[3],f,f,f,c),M(a,b[3],b[1],b[2],f,f,f,c);else{for(var k=[0,0,0,0],h=b[d-1],e=0;e<d;++e)k=qa(k,b[e]);for(e=0;e<d;++e)M(a,h,b[e],k,f,f,f,c),h=b[e]}}}
function gb(a,b,c,d){if(3==b.length)M(a,b[0],b[1],b[2],c[0],c[1],c[2],d);else if(4==b.length)M(a,b[0],b[1],b[3],c[0],c[1],c[3],d),M(a,b[3],b[1],b[2],c[3],c[1],c[2],d);else{var e=b.length,f,k=[0,0,0,0],h=[0,0,0];for(f=0;f<e;++f)k=qa(k,b[f]),h=pa(h,c[f]);var l=b[e-1],g=c[e-1];for(f=0;f<e;++f)M(a,l,b[f],k,g,c[f],h,d),l=b[f],g=c[f]}}q.m=null;q.Z=null;q.N=null;q.ha=null;q.ia=null;
q.B=function(a){var b=a.f;if(this.m){if(this.m.ready){this.m.oa&&this.m.oa();this.Z||(this.Z=b.createTexture());var c=this.m.width,d=this.m.height,c=hb(c),d=hb(d);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.Z);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR);b.hint(b.GENERATE_MIPMAP_HINT,
b.NICEST);if(this.m.live||this.ha!==this.m||this.ia!==this.m.generation){this.ha=this.m;this.ia=this.m.generation;var e=this.m.img;if(c!==this.m.width||d!==this.m.height)this.N||(this.N=document.createElement("canvas"),this.N.width=c,this.N.height=d),e=this.N.getContext("2d"),e.clearRect(0,0,c,d),e.drawImage(this.m.img,0,0,c,d),e=this.N;b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,e);b.generateMipmap(b.TEXTURE_2D)}db(this,b,function(b){a.h(b);b.uTextured([!0]);b.uTexture([0])});b.bindTexture(b.TEXTURE_2D,
null)}}else db(this,b,function(b){a.h(b);b.uTextured([!1])})};function hb(a){if(!(a&a-1))return a;for(var b=1;b<a;)b*=2;return b};function N(a){var b;b=b?b:null;return"list"!==a.ctype?(console.log("argument is not a list"),b):a.value}function O(a,b,c){b=b?b:[0,0,0,0];c=void 0===c?3:c;a=N(a);if(!a)return b;b=a.map(P);b.length>c+1&&(console.log("Coordinate vector too long."),b=b.slice(0,c+1));for(;b.length<c;)b.push(0);b.length===c&&b.push(1);return b}function T(a,b){b=b?b:[0,0,0];a=N(a);if(!a)return b;b=a.map(P);3<b.length&&(console.log("Coordinate vector too long."),b=b.slice(0,3));for(;3>b.length;)b.push(0);return b}
function ib(a,b){b=b?b:[0,0,0,0];a=T(a,b);a!==b&&(a[3]=0);return a}function U(a,b){b=b?b:[.5,.5,.5];if("number"===a.ctype){var c=V(0,1,a);if(!isNaN(c))return[c,c,c]}a=N(a);return a?3!=a.length?(console.log("Not an RGB color vector"),b):a.map(function(a){return V(0,1,a)}):b}function P(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;a=a.value;b=a.real;0!==a.imag&&console.log("complex number is not real");return b}
function W(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;b=a.value;a=b.real;b=b.imag;0!==b&&console.log("complex number is not real");b=Math.round(a);b!==a&&console.log("number is not an integer");return b}function V(a,b,c,d){d=void 0===d?Number.NaN:d;c=P(c,d);return c<a?a:c>b?b:c}function X(a,b){b=void 0===b?null:b;if("string"===a.ctype)return a.value;console.log("argument is not a string");return b}
function jb(a,b){var c=["camera","world"];b=void 0===b?null:b;a=X(a,b);if(a!==b&&-1!==c.indexOf(a))return a;console.log("argument is not one of "+c.join(", "));return b};CindyJS.registerPlugin(1,"Cindy3D",function(a){function b(a,b){var c,d;for(c in a)(d=b[c])?d(l(a[c])):console.log("Modifier "+c+" not supported")}function c(a,c,d){d=d?d:null;var e=a.color,f=a.alpha,h=a.s,m=a.size;a={color:function(a){return e=U(a)},alpha:function(a){return f=V(0,1,a)},shininess:function(a){return h=V(0,128,a)},size:function(a){return m=.05*P(a)}};var l;if(d)for(l in d)a[l]=d[l];b(c,a);return{color:e,alpha:f,s:h,size:m}}function d(a){m.v.alpha=V(0,1,l(a[0]),1);return h}function e(a,
b,c,d,e){for(var f=0,h=1;h<a;++h){for(var m=1;m<b;++m)e(f,f+1,f+b+1,f+b),++f;c&&e(f,f+1-b,f+1,f+b);++f}if(d){for(a=1;a<b;++a)e(f,f+1,a,a-1),++f;c&&e(f,f+1-b,0,b-1)}}function f(a,b,c,d,f,h,l,g,k){var n;n=l?"perface"===g?function(a){return l[a]}:function(a,b){return l[b]}:function(){return k.color};e(a,b,c,d,function(a,b,c,d){var e;e=m.w;var p=[f[a],f[b],f[c],f[d]],l=[h[a],h[b],h[c],h[d]];a=[n(a,a),n(a,b),n(a,c),n(a,d)];3==p.length?e=eb(e,p[0],p[1],p[2],l[0],l[1],l[2],a[0],a[1],a[2],k):(4==p.length?
(eb(e,p[0],p[1],p[3],l[0],l[1],l[3],a[0],a[1],a[3],k),eb(e,p[3],p[1],p[2],l[3],l[1],l[2],a[3],a[1],a[2],k)):console.error("addPolygonWithNormalsAndColors not supported for more than 4 corners"),e=void 0);return e})}function k(b,d){function k(a,b){a=z(y(a,ya),y(b,ya));F[0]+=a[0];F[1]+=a[1];F[2]+=a[2];++za}var g=W(l(b[0])),w=W(l(b[1])),n=N(l(b[2])).map(function(a){return O(a)}),ua="perface",Y="pervertex",A="open",Q=null,va=null,wa=null,xa=c(m.v,d,{normaltype:function(a){return ua=X(a,ua).toLowerCase()},
colortype:function(a){return Y=X(a,Y).toLowerCase()},topology:function(a){return A=X(a,A).toLowerCase()},colors:function(a){return Q=N(a).map(function(a){return U(a)})},uv:function(a){return va=N(a).map(function(a){return O(a,[0,0,0],2)})},texture:function(b){return wa=a.getImage(b,!0)}});if(n.length!==g*w)return h;wa&&va&&(m.w.m=wa,m.w.C=!1,Q=va,Y="pervertex");if(null!==Q&&Q.length!==g*w)return h;d="closerows"===A||"closeboth"===A;var J="closecolumns"===A||"closeboth"===A,ya=null,F=null,za=0;if(4===
b.length){b=N(l(b[3])).map(function(a){return T(a)});if(b.length!==g*w)return h;f(g,w,d,J,n,b,Q,Y,xa)}else if("pervertex"===ua){b=Array(g*w);for(var Z=g*w,aa=n.map(x),R=0,Aa=0;R<g;++R)for(var S=0;S<w;++S){var K=Aa+Z,ya=aa[Aa],Xa=aa[(K-1)%Z],Ya=aa[(K+1)%Z],Za=aa[(K-w)%Z],K=aa[(K+w)%Z],F=[0,0,0],za=0;(J||0<R)&&(d||0<S)&&k(Xa,Za);(J||R+1<g)&&(d||0<S)&&k(K,Xa);(J||R+1<g)&&(d||S+1<w)&&k(Ya,K);(J||0<R)&&(d||S+1<w)&&k(Za,Ya);b[Aa++]=oa(4/za,F)}f(g,w,d,J,n,b,Q,Y,xa)}else e(g,w,d,J,function(a,b,c,d){return fb(m.w,
[n[a],n[b],n[c],n[d]],xa)});return h}var h=a.nada,l=a.evaluate,g=a.defineFunction,n={},m;g("begin3d",0,function(c,d){var e="Cindy3D",f={},l={};b(d,{name:function(a){return e=X(a,e)},antialias:function(a){"boolean"===a.ctype?a=a.value:(console.log("argument is not boolean"),a=!1);return f.antialias=a},supersample:function(a){return l.ja=P(a,1)}});(m=n[e])||(n[e]=m=new Ha(e,f,l,a.addAutoCleaningEventListener));m.clear();return h});g("end3d",0,function(){m.B();m=null;return h});g("gsave3d",0,function(){m.fa.push({U:C(m.D),
T:C(m.A),V:C(m.v)});return h});g("grestore3d",0,function(){var a=m.fa;0<a.length?(a=a.pop(),m.D=a.U,m.A=a.T,m.v=a.V):(m.D=C(H.U),m.A=C(H.T),m.v=C(H.V));return h});g("color3d",1,function(a){if(a=U(l(a[0]),null))m.D.color=a,m.A.color=a,m.v.color=a;return h});g("pointcolor3d",1,function(a){if(a=U(l(a[0]),null))m.D.color=a;return h});g("linecolor3d",1,function(a){if(a=U(l(a[0]),null))m.A.color=a;return h});g("surfacecolor3d",1,function(a){if(a=U(l(a[0]),null))m.v.color=a;return h});g("alpha3d",1,d);g("surfacealpha3d",
1,d);g("shininess3d",1,function(a){a=V(0,128,l(a[0]));isNaN(a)||(m.D.s=a,m.A.s=a,m.v.s=a);return h});g("pointshininess3d",1,function(a){a=V(0,128,l(a[0]));isNaN(a)||(m.D.s=a);return h});g("lineshininess3d",1,function(a){a=V(0,128,l(a[0]));isNaN(a)||(m.A.s=a);return h});g("surfaceshininess3d",1,function(a){a=V(0,128,l(a[0]));isNaN(a)||(m.v.s=a);return h});g("size3d",1,function(a){a=.05*P(l(a[0]),-1);0<=a&&(m.D.size=a,m.A.size=a);return h});g("pointsize3d",1,function(a){a=.05*P(l(a[0]),-1);0<=a&&(m.D.size=
a);return h});g("linesize3d",1,function(a){a=.05*P(l(a[0]),-1);0<=a&&(m.A.size=a);return h});g("draw3d",1,function(a,b){a=O(l(a[0]));b=c(m.D,b);m.L.add(a,b.size,b);return h});g("draw3d",2,function(a,b){var d=O(l(a[0]));a=O(l(a[1]));b=c(m.A,b);m.K.add(d,a,b);return h});g("connect3d",1,function(a,b){a=N(l(a[0]));b=c(m.A,b);if(2>a.length)return h;for(var d=O(a[0]),e=1;e<a.length;++e){var f=O(a[e]);m.K.add(d,f,b);d=f}return h});g("drawpoly3d",1,function(a,b){a=N(l(a[0]));b=c(m.A,b);if(2>a.length)return h;
for(var d=O(a[a.length-1]),e=0;e<a.length;++e){var f=O(a[e]);m.K.add(d,f,b);d=f}return h});g("fillpoly3d",1,function(a,b){a=N(l(a[0]));b=c(m.v,b);if(2>a.length)return h;a=a.map(function(a){return O(a)});fb(m.w,a,b);return h});g("fillpoly3d",2,function(a,b){var d=N(l(a[0]));a=N(l(a[1]));b=c(m.v,b);if(2>d.length||d.length!=a.length)return h;d=d.map(function(a){return O(a)});a=a.map(function(a){return T(a)});gb(m.w,d,a,b);return h});g("fillcircle3d",3,function(){return h});g("drawsphere3d",2,function(a,
b){var d=O(l(a[0]));a=P(l(a[1]));b=c(m.v,b);m.L.add(d,a,b);return h});g("mesh3d",3,function(a,b){return k(a,b)});g("mesh3d",4,function(a,b){return k(a,b)});g("triangle3d",1,function(b,d){b=N(l(b[0])).map(function(a){return O(a)});var e=null,f=null,g=null,k=null;d=c(m.v,d,{colors:function(a){return k=N(a).map(function(a){return U(a)})},uv:function(a){return e=N(a).map(function(a){return O(a,[0,0,0],2)})},texture:function(a){return f=X(a)},normals:function(a){return g=N(a).map(function(a){return T(a)})}});
if(!b||3!==b.length)return h;if(null!==f&&e){var n=a.getImage(f);if(!n)return console.log("No such texture image: "+f),h;m.w.m=n;m.w.C=!1;k=e}if(null!==k&&3!==k.length||g&&3!==g.length)return h;k||(k=[d.color,d.color,d.color]);g||(n=ra(b[0],b[1],b[2]),g=[n,n,n]);eb(m.w,b[0],b[1],b[2],g[0],g[1],g[2],k[0],k[1],k[2],d);return h});g("background3d",1,function(a){if(a=U(l(a[0]),null))a.push(1),m.backgroundColor=a;return h});g("lookat3d",3,function(a){var b=O(l(a[0]),null),c=O(l(a[1]),null);a=T(l(a[2]),
null);b&&c&&a&&Ba(m.j,x(b),x(c),a);return h});g("fieldofview3d",1,function(a){a=V(.01,3.13,l(a[0]),0);0<a&&(m.j.ga=a,ta(m.j));return h});g("depthrange3d",2,function(a){var b=P(l(a[0]),-1);a=P(l(a[1]),-1);0<=b&&a>b&&(m.j.X=b,m.j.W=a,ta(m.j));return h});g("renderhints3d",0,function(){return h});g("pointlight3d",1,function(a,c){a=W(l(a[0]),0);var d=[0,0,0,1],e=[1,1,1],f=[1,1,1],g="camera";b(c,{position:function(a){return d=O(a,d)},diffuse:function(a){return e=U(a,e)},specular:function(a){return f=U(a,
f)},frame:function(a){return g=jb(a,g)}});Ra(m.F,a,new Va[g](d,e,f));return h});g("directionallight3d",1,function(a,c){a=W(l(a[0]),0);var d=[0,-1,0,0],e=[1,1,1],f=[1,1,1],g="camera";b(c,{direction:function(a){return d=ib(a,d)},diffuse:function(a){return e=U(a,e)},specular:function(a){return f=U(a,f)},frame:function(a){return g=jb(a,g)}});Ra(m.F,a,new Va[g](d,e,f));return h});g("spotlight3d",1,function(a,c){a=W(l(a[0]),0);var d=[0,0,0,1],e=[0,-1,0,0],f=Math.PI/4,g=0,k=[1,1,1],n=[1,1,1],A="camera";
b(c,{position:function(a){return d=O(a,d)},direction:function(a){return e=ib(a,e)},cutoffangle:function(a){return f=V(0,Math.PI,a,f)},exponent:function(a){return g=P(a,g)},diffuse:function(a){return k=U(a,k)},specular:function(a){return n=U(a,n)},frame:function(a){return A=jb(a,A)}});Ra(m.F,a,new ab[A](d,e,Math.cos(f),g,k,n));return h});g("disablelight3d",1,function(a){a=W(l(a[0]),0);Ra(m.F,a,null);return h});g("ambientlight3d",1,function(a){if(a=U(l(a[0])))m.F.ea=a;return h})});
}).call(this);//# sourceMappingURL=Cindy3D.js.map

