function complex_expression(s){const consts={i:{r:0,i:1},pi:{r:Math.PI,i:0},e:{r:Math.E,i:0}};var vars={m:"m",n:"n",t:"t",r:"r",s:"s",u:"u",z:"z","z'":"zp"},funcs={random:0,re:1,im:1,modulus:1,arg:1,recip:1,neg:1,conj:1,disk:1,floor:1,ceil:1,square:1,cube:1,sqrt:1,exp:1,log:1,sin:1,cos:1,tan:1,cot:1,sec:1,csc:1,sinh:1,cosh:1,tanh:1,coth:1,sech:1,csch:1,asin:1,acos:1,atan:1,arcsin:1,arccos:1,arctan:1,arccot:1,arcsec:1,arccsc:1,arcsinh:1,arccosh:1,arctanh:1,arccoth:1,arcsech:1,arccsch:1,gamma:1,pow:2,rationalBlaschke:2,mobius:5,psymbol:2,joukowsky:1,binomial:2,sn:2,cn:2,dn:2,sum:2,prod:2,blaschke:2,iter:3},syns={asin:"arcsin",acos:"arccos",atan:"arctan"},params=[{name:"t",defn:"{r:par,i:0}",caption:function(r){return"t = "+r.toFixed(3)}},{name:"u",defn:"{r:Math.cos(Math.PI*2*par),i:Math.sin(Math.PI*2*par)}",caption:function(r){var t=Math.sin(2*Math.PI*r)+3e-16;return"u = "+(Math.cos(2*Math.PI*r)+3e-16).toFixed(2)+(t>=0?" + ":" - ")+Math.abs(t).toFixed(2)+"i"}},{name:"n",defn:"{r:Math.floor(par*par*59 + 1.5),i:0}",caption:function(r){return"n = "+Math.floor(r*r*59+1.5)}},{name:"s",defn:"{r:Math.sin(Math.PI*2*par),i:0}",caption:function(r){return"s = "+(Math.sin(2*Math.PI*r)+3e-16).toFixed(3)}},{name:"r",defn:"{r:0.5-Math.cos(Math.PI*2*par)/2,i:0}",caption:function(r){return"r = "+(.5-Math.cos(2*Math.PI*r)/2+3e-16).toFixed(3)}}],loops={iter:1,sum:1,prod:1},symbols={},factorials=[],mds=[],args=[],values=[];function run(){dictadd(symbols,consts),dictadd(symbols,vars),dictadd(symbols,funcs),init_constants(),init_ai();var state={tok:tokenize(s),j:0};if(null===state.tok)return null;var result=parsesum(state,!1);if(null===result||state.j<state.tok.length)return null;var parameters=[];if(result.vars.hasOwnProperty("z'"))return null;var fntext="(function(z,par){";result.vars.hasOwnProperty("m")&&(defns+="var m = expi(z); ");for(var j=0;j<params.length;++j)result.vars.hasOwnProperty(params[j].name)&&(params[j].defn&&(fntext+="var "+params[j].name+"="+params[j].defn+";"),parameters.push({name:params[j].name,caption:params[j].caption}));return fntext+="return "+result.expr+";})",{fn:eval(fntext),fntext:fntext,parameters:parameters}}function init_constants(){factorials.push(1);for(var r=0;r<160;++r)factorials.push(factorials[factorials.length-1]*factorials.length)}function init_ai(){for(let r=0;r<100;r++)mds[r]=Math.random(),args[r]=2*Math.PI*Math.random(),values[r]={r:mds[r]*Math.cos(args[r]),i:mds[r]*Math.sin(args[r])}}function primeFactorsTo(r){var t,a,e=[],n=[];for(t=2;t<=r;++t)if(!e[t])for(n.push(t),a=t<<1;a<=r;a+=t)e[a]=!0;return n}function random(){for(;;){var r={r:2*Math.random()-1,i:2*Math.random()-1};if(modulussquared(r)<1)return r}}let re=r=>({r:r.r,i:0}),im=r=>({r:r.i,i:0}),scale=(r,t)=>({r:t.r*r,i:t.i*r}),modulussquared=r=>r.r*r.r+r.i*r.i,realmodulus=r=>Math.sqrt(modulussquared(r)),modulus=r=>0==r.i?{r:Math.abs(r.r),i:0}:{r:realmodulus(r),i:0},realarg=r=>Math.atan2(r.i,r.r),arg=r=>({r:realarg(r),i:0}),add=(r,t)=>({r:r.r+t.r,i:r.i+t.i}),sub=(r,t)=>({r:r.r-t.r,i:r.i-t.i}),mult=(r,t)=>({r:r.r*t.r-r.i*t.i,i:r.r*t.i+r.i*t.r}),div=(r,t)=>{var a=modulussquared(t);return{r:(r.r*t.r+r.i*t.i)/a,i:(r.i*t.r-r.r*t.i)/a}},recip=r=>{var t=modulussquared(r);return{r:r.r/t,i:-r.i/t}},neg=r=>({r:-r.r,i:-r.i}),conj=r=>({r:r.r,i:-r.i});function disk(r){return realmodulus(r)>1?NaN:{r:1,i:0}}let exp=r=>{var t=Math.exp(r.r);return{r:t*Math.cos(r.i),i:t*Math.sin(r.i)}},expi=r=>{var t=Math.exp(-r.i);return{r:t*Math.cos(r.r),i:t*Math.sin(r.r)}},log=r=>({r:Math.log(realmodulus(r)),i:realarg(r)}),realsinh=r=>(-Math.exp(-r)+Math.exp(r))/2,realcosh=r=>(Math.exp(-r)+Math.exp(r))/2,realtanh=r=>(1-Math.exp(-2*r))/(1+Math.exp(-2*r)),sin=r=>{var t=Math.exp(r.i),a=1/t;return{r:.5*(t+a)*Math.sin(r.r),i:.5*(t-a)*Math.cos(r.r)}},cos=r=>{var t=Math.exp(r.i),a=1/t;return{r:.5*(a+t)*Math.cos(r.r),i:.5*(a-t)*Math.sin(r.r)}},sec=r=>recip(cos(r)),csc=r=>recip(sin(r)),tan=r=>{var t=Math.exp(r.i),a=1/t,e=t+a,n=t-a,i=Math.sin(r.r),s=Math.cos(r.r);return div({r:e*i,i:n*s},{r:e*s,i:-n*i})},cot=r=>{var t=Math.exp(r.i),a=1/t,e=t+a,n=t-a,i=Math.sin(r.r),s=Math.cos(r.r);return div({r:e*s,i:-n*i},{r:e*i,i:n*s})},sinh=r=>negitimes(sin(itimes(r))),cosh=r=>cos(itimes(r)),tanh=r=>negitimes(tan(itimes(r))),coth=r=>itimes(cot(itimes(r))),sech=r=>sec(itimes(r)),csch=r=>itimes(csc(itimes(r))),intpow=(r,t)=>1==t?r:t%2==0?square(intpow(r,t/2)):t%3==0?cube(intpow(r,t/3)):t%5==0?p5(intpow(r,t/5)):mult(r,intpow(r,t-1)),realpow=(r,t)=>{if(t==Math.floor(t)){if(t>0&&t<=64)return intpow(r,t);if(t<0&&t>=-64)return recip(intpow(r,-t));if(0==t)return{r:1,i:0}}var a=realarg(r)*t,e=Math.pow(realmodulus(r),t);return{r:e*Math.cos(a),i:e*Math.sin(a)}},powreal=(r,t)=>exp(scale(Math.log(r),t)),pow=(r,t)=>0==t.i?realpow(r,t.r):0==r.i?powreal(r.r,t):exp(mult(log(r),t)),floor=r=>({r:Math.floor(r.r),i:Math.floor(r.i)}),ceil=r=>({r:Math.ceil(r.r),i:Math.ceil(r.i)}),square=r=>{var t=r.r*r.i;return{r:r.r*r.r-r.i*r.i,i:t+t}},cube=r=>{var t=r.r*r.r,a=r.i*r.i;return{r:r.r*(t-3*a),i:r.i*(3*t-a)}},p5=r=>{var t=r.r*r.r,a=r.i*r.i,e=t*a,n=e+e,i=t*t,s=a*a;return{r:r.r*(i+5*(s-n)),i:r.i*(s+5*(i-n))}},sqrt=r=>{var t=Math.sqrt((Math.abs(r.r)+realmodulus(r))/2),a=r.i/t/2;return r.r<0?r.i<0?{r:-a,i:-t}:{r:a,i:t}:{r:t,i:a}},itimes=r=>({r:-r.i,i:r.r}),negitimes=r=>({r:r.i,i:-r.r}),oneminus=r=>({r:1-r.r,i:-r.i}),oneplus=r=>({r:1+r.r,i:r.i}),minusone=r=>({r:r.r-1,i:r.i}),arcsin=r=>negitimes(log(add(itimes(r),sqrt(oneminus(square(r)))))),arccos=r=>negitimes(log(add(r,itimes(sqrt(oneminus(square(r))))))),arctan=r=>scale(.5,itimes(sub(log(oneminus(itimes(r))),log(oneplus(itimes(r)))))),arccot=r=>arctan(recip(r)),arcsec=r=>arccos(recip(r)),arccsc=r=>arcsin(recip(r)),arcsinh=r=>{var t=oneplus(square(r));return log(add(r,scale(Math.sqrt(realmodulus(t)),exp({r:0,i:realarg(t)/2}))))},arccosh=r=>{var t=minusone(square(r));return log(add(r,scale(Math.sqrt(realmodulus(t)),exp({r:0,i:realarg(t)/2}))))},arctanh=r=>scale(.5,sub(log(oneplus(r)),log(oneminus(r)))),arccoth=r=>scale(.5,sub(log(oneplus(r)),log(minusone(r)))),arcsech=r=>negitimes(arcsec(r)),arccsch=r=>negitimes(arccsc(negitimes(r)));function binomial(r,t){if(0==r.i&&r.r==Math.floor(r.r)&&r.r>=0&&0==t.i&&t.r==Math.floor(t.r)&&t.r>=0&&t.r<=r.r){if(r.r<21)return{r:factorials[r.r]/factorials[t.r]/factorials[r.r-t.r],i:0};var a,e=Math.min(t.r,r.r-t.r),n=r.r,i=1;for(a=1;a<=e;++a)i=i*(n-(e-a))/a;return{r:i,i:0}}return div(gamma(oneplus(r)),mult(gamma(oneplus(t)),gamma(oneplus(sub(r,t)))))}let factorial=r=>0==r.i&&r.r==Math.floor(r.r)&&r.r>=0&&r.r<factorials.length?{r:factorials[r.r],i:0}:gamma(oneplus(r)),gamma=r=>{var t=Math.sqrt(2*Math.PI),a=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];if(r.r<.5)return scale(Math.PI,recip(mult(sin(scale(Math.PI,r)),gamma(oneminus(r)))));var e,n,i=minusone(r),s={r:a[0],i:0};for(e=1;e<9;++e)s=add(s,scale(a[e],recip({r:i.r+e,i:i.i})));return n={r:i.r+7+.5,i:i.i},scale(t,mult(mult(pow(n,{r:i.r+.5,i:i.i}),exp(neg(n))),s))},sn=(r,t)=>{"object"==typeof t&&(t=t.r);var a=Math.sqrt(1-t*t),e=realellipj(r.r,t),n=realellipj(r.i,a),i=1-e.dn*e.dn*n.sn*n.sn;return{r:e.sn*n.dn/i,i:e.cn*e.dn*n.sn*n.cn/i}},cn=(r,t)=>{"object"==typeof t&&(t=t.r);var a=Math.sqrt(1-t*t),e=realellipj(r.r,t),n=realellipj(r.i,a),i=1-e.dn*e.dn*n.sn*n.sn;return{r:e.cn*n.cn/i,i:-e.sn*e.dn*n.sn*n.dn/i}},dn=(r,t)=>{"object"==typeof t&&(t=t.r);var a=Math.sqrt(1-t*t),e=realellipj(r.r,t),n=realellipj(r.i,a),i=1-e.dn*e.dn*n.sn*n.sn;return{r:e.dn*n.cn*n.dn/i,i:-t*t*e.sn*e.cn*n.sn/i}},sum=(r,t,a)=>{var e,n,i=0,s=0,o=Math.floor(a.r);for(e=0;e<o;++e)i+=(n=t(r,{r:e,i:0})).r,s+=n.i;return{r:i,i:s}},iter=(r,t,a,e)=>{var n,i=a,s=Math.floor(e.r);for(n=0;n<s;++n)i=t(r,i,{r:n,i:0});return i};function realellipj(r,a){var e,n,i,s,o,l,u=[],c=[];if(a<0||a>1)return{sn:NaN,cn:NaN,ph:NaN,dn:NaN};if(a<1e-9)return t=Math.sin(r),i=Math.cos(r),e=.25*a*(r-t*i),{sn:t-e*i,cn:i+e*t,ph:r-e,dn:1-.5*a*t*t};if(a>=.9999999999)return e=.25*(1-a),i=realcosh(r),t=realtanh(r),s=1/i,n=e*t*s,o=i*realsinh(r),{sn:t+e*(o-r)/(i*i),ph:2*Math.atan(Math.exp(r))-Math.PI/2+e*(o-r)/i,cn:s-n*(o-r),dn:s+n*(o+r)};for(u[0]=1,i=Math.sqrt(1-a),c[0]=Math.sqrt(a),o=1,l=0;Math.abs(c[l]/u[l])>2.22045e-16&&l<8;)e=u[l],c[++l]=(e-i)/2,t=Math.sqrt(e*i),u[l]=(e+i)/2,i=t,o*=2;s=o*u[l]*r;do{t=c[l]*Math.sin(s)/u[l],i=s,s=(Math.asin(t)+s)/2}while(--l);return t=Math.cos(s),{sn:Math.sin(s),cn:t,dn:t/Math.cos(s-i),ph:s}}function prod(r,t,a){let e,n=t(r,{r:1,i:0}),i=Math.floor(a.r);if(i<1)return NaN;if(1===i)return t(r,{r:1,i:0});for(e=2;e<=i;++e)n=mult(n,t(r,{r:e,i:0}));return n}function psymbol(r,t){var a,e={r:1,i:0},n=Math.floor(t.r);if(0===n)return{r:1,i:0};if(n>0){for(a=1;a<=n;++a)e=mult(e,add(r,{r:a-1,i:0}));return e}}function mobius(r,t,a,e,n){let i={r:r.r*t.r-r.i*t.i+a.r,i:r.r*t.i+r.i*t.r+a.i},s={r:r.r*e.r-r.i*e.i+n.r,i:r.r*e.i+r.i*e.r+n.i},o=sub(mult(t,n),mult(a,e));return 0===o.r&&0===o.i?null:div(i,s)}function rationalBlaschke(r,t){let a=div({r:r.r-t.r,i:r.i-t.i},{r:1-t.r*r.r-t.i*r.i,i:t.i*r.r-t.r*r.i}),e=div({r:Math.sqrt(t.r*t.r+t.i*t.i),i:0},{r:t.r,i:t.i});return mult(e,a)}function blaschke(r,t){var a,e=rationalBlaschke(r,values[0]),n=Math.floor(t.r);if(n>100||n<1)return NaN;for(a=1;a<n;a++)e=mult(e,rationalBlaschke(r,values[a]));return mult({r:.0256,i:.1321},e)}let joukowsky=r=>{let t,a={r:1,i:0},e={r:.23*Math.sqrt(26),i:0},n={r:-.15,i:.23},i=sqrt(sub(square(r),{r:4,i:0})),s=div(sub(r,i),{r:2,i:0}),o=div(add(r,i),{r:2,i:0}),l=sub(s,n),u=sub(o,n);return t=realmodulus(l)>realmodulus(u)?div(sub(s,n),e):div(sub(o,n),e),realmodulus(t)<realmodulus(a)?0:add(t,div(a,t))};function splitwords(r){for(var t=r.text,a=[],e=0;e<t.length;){for(var n=!1,i=t.length;i>e;--i){var s=t.substring(e,i);if(symbols.hasOwnProperty(s)){a.push({spaced:0==e&&r.spaced,text:s}),e=i,n=!0;break}}if(!n){a.push({spaced:0==e&&r.spaced,text:t.substring(e)});break}}return a}function tokenize(r){for(var t,a=/(\s*)(?:((?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?|\*\*|[-+()^|,*\/!]|[a-zA-Z_]+'?)|(\S.*))/g,e=[];null!==(t=a.exec(r));){if(t[3])return null;if(t[2]){var n={spaced:t[1]&&t[1].length>0,text:t[2]};/^\w/.exec(n.text)?e.push.apply(e,splitwords(n)):e.push(n)}}return e}function parsesum(r,t){for(var a=null,e=null;;){var n=parseproduct(r,t);if(null===n)return null;if(a=null===a?n:compose(e,[a,n]),r.j<r.tok.length){var i=r.tok[r.j];if("+"==i.text||"-"==i.text){e="+"==i.text?"add":"sub",r.j+=1;continue}}break}return a}function parseproduct(r,t){for(var a=null,e=-1,n=null;;){var i=parseunary(r,e>=0,t);if(null===i)return r.j==e?a:null;if(a=null===a?i:compose(n,[a,i]),r.j<r.tok.length){var s=r.tok[r.j];if("*"==s.text||"/"==s.text){n="*"==s.text?"mult":"div",r.j+=1,e=-1;continue}if(!t||"|"!=s.text){n="mult",e=r.j;continue}}break}return a}function parseunary(r,t,a){if(r.j<r.tok.length){var e=r.tok[r.j];if(!t&&"-"==e.text){r.j+=1;var n=parseunary(r,a);return null===n?null:compose("neg",[n])}}return parsetightproduct(r,a)}function parsetightproduct(r,t){for(var a=null,e=-1;;){var n=parsepower(r,t);if(null===n)return r.j==e?a:null;if(a=null===a?n:compose("mult",[a,n]),r.j<r.tok.length){var i=r.tok[r.j];if(/^[\w\d\.]/.exec(i.text)&&!i.spaced){e=r.j;continue}}break}return a}function parsepower(r,t){var a=parsesuffixed(r,t);if(null===a)return null;if(r.j<r.tok.length){var e=r.tok[r.j];if("^"==e.text||"**"==e.text){r.j+=1;var n=parseunary(r,t);return null===n?null:compose("pow",[a,n])}}return a}function parsesuffixed(r,t){var a=parseunit(r);if(null===a)return null;for(var e=!0;e;){if(e=!1,r.j<r.tok.length&&"*"==r.tok[r.j].text){var n=!0;if(r.j+1>=r.tok.length)n=!1;else{var i=r.tok[r.j+1];(")"==i.text||"*"==i.text||"/"==i.text||"+"==i.text||"-"==i.text||"^"==i.text||t&&"|"==i.text)&&(n=!1)}n||(r.j+=1,a=compose("conj",[a]),e=!0)}r.j<r.tok.length&&"!"==r.tok[r.j].text&&(r.j+=1,a=compose("factorial",[a]),e=!0)}return a}function parseunit(r){if(r.j>=r.tok.length)return null;var t,a=r.tok[r.j];if(/^\d|\./.exec(a.text))return r.j+=1,composereal(parseFloat(a.text));if(/^\w/.exec(a.text)){if(r.j+=1,r.j<r.tok.length&&"("==r.tok[r.j].text&&funcs.hasOwnProperty(a.text)){var e=funcs[a.text],n=[];if(r.j+=1,0==e){if(r.j>=r.tok.length||")"!=r.tok[r.j].text)return null;r.j+=1}for(;e>0;){var i=parsesum(r,!1);if(null==i)return null;if(n.push(i),e-=1,r.j>=r.tok.length||r.tok[r.j].text!=(e?",":")")){if(!(loops.hasOwnProperty(a.text)&&r.j<r.tok.length&&")"==r.tok[r.j].text))return null;for(;e>1;)n.push(composereal(0)),e-=1;n.push({expr:"n",vars:{n:"n"},val:null}),e-=1}r.j+=1}if(loops.hasOwnProperty(a.text)){dictadd(c={},n[0].vars);var s="function(z,n)";delete c.n,"iter"==a.text&&(s="function(z,zp,n)",delete c["z'"]);for(var o=["z",s+"{return "+n[0].expr+";}"],l=1;l<n.length;++l)dictadd(c,n[l].vars),o.push(n[l].expr);return{expr:a.text+"("+o.join(",")+")",vars:c,val:null}}var u=a.text;return syns.hasOwnProperty(u)&&(u=syns[u]),compose(u,n)}var c;if(vars.hasOwnProperty(a.text))return(c={})[a.text]=vars[a.text],{expr:vars[a.text],vars:c,val:null};if(consts.hasOwnProperty(a.text)){var p=consts[a.text];return{expr:"{r:"+p.r+",i:"+p.i+"}",vars:{},val:p}}}return"("==a.text||"|"==a.text?(r.j+=1,t=parsesum(r,"|"==a.text),r.j>=r.tok.length||r.tok[r.j].text!=("|"==a.text?"|":")")?null:(r.j+=1,"|"==a.text?compose("modulus",[t]):t)):null}function composereal(r){return{expr:"{r:"+r+",i:0}",vars:{},val:{r:r,i:0}}}function compose(fname,args){for(var vs={},ae=[],av=[],vl=null,valcount=0,fn=eval(fname),j=0;j<args.length;++j)dictadd(vs,args[j].vars),ae.push(args[j].expr),av.push(args[j].val),null!==args[j].val&&++valcount;if(0==dictsize(vs)&&valcount==args.length&&args.length>0)return vl=fn.apply(null,av),{expr:"{r:"+vl.r+",i:"+vl.i+"}",vars:vs,val:vl};if((fn===mult||fn===div)&&isreal(1,av[1]))return args[0];if(fn===mult&&null!==av[0]&&0==av[0].i)return isreal(1,av[0])?args[1]:{expr:"scale("+av[0].r+","+ae[1]+")",vars:vs,val:null};if(fn===div&&null!==av[1]&&0==av[1].i&&0!=av[1].r)return isreal(1,av[1])?args[1]:{expr:"scale("+1/av[1].r+","+ae[0]+")",vars:vs,val:null};if(fn===div&&null!==av[0]&&0==av[0].i){var r=compose("recip",[args[1]]);return isreal(1,av[0])?r:{expr:"scale("+av[0].r+","+r.expr+")",vars:vs,val:null}}if(fn===pow){if(isreal(-1,av[1]))return compose("recip",[args[0]]);if(isreal(0,av[1]))return composereal(1);if(isreal(.5,av[1]))return compose("sqrt",[args[0]]);if(isreal(1,av[1]))return args[0];if(isreal(2,av[1]))return compose("square",[args[0]]);if(isreal(3,av[1]))return compose("cube",[args[0]]);if(isreal(4,av[1]))return compose("square",[compose("square",[args[0]])]);if(isreal(5,av[1]))return compose("p5",[args[0]]);if(isreal(6,av[1]))return compose("square",[compose("cube",[args[0]])]);if(isreal(Math.E,av[0]))return compose("exp",[args[1]])}return{expr:fname+"("+ae.join(",")+")",vars:vs,val:null}}function isreal(r,t){return null!==t&&0==t.i&&t.r==r}function dictsize(r){var t,a=0;for(t in r)r.hasOwnProperty(t)&&++a;return a}function dictadd(r,t){for(key in t)t.hasOwnProperty(key)&&(r[key]=t[key])}return run()}